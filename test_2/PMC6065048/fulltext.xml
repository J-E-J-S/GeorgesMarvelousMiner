<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN" "JATS-archivearticle1.dtd"> 
<article xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:mml="http://www.w3.org/1998/Math/MathML" article-type="research-article"><?properties open_access?><?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?><?DTDIdentifier.IdentifierType public?><?SourceDTD.DTDName JATS-journalpublishing1.dtd?><?SourceDTD.Version 1.1?><?ConverterInfo.XSLTName jp2nlmx2.xsl?><?ConverterInfo.Version 1?><front><journal-meta><journal-id journal-id-type="nlm-ta">Proc Natl Acad Sci U S A</journal-id><journal-id journal-id-type="iso-abbrev">Proc. Natl. Acad. Sci. U.S.A</journal-id><journal-id journal-id-type="hwp">pnas</journal-id><journal-id journal-id-type="pmc">pnas</journal-id><journal-id journal-id-type="publisher-id">PNAS</journal-id><journal-title-group><journal-title>Proceedings of the National Academy of Sciences of the United States of America</journal-title></journal-title-group><issn pub-type="ppub">0027-8424</issn><issn pub-type="epub">1091-6490</issn><publisher><publisher-name>National Academy of Sciences</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="pmcid">6065048</article-id><article-id pub-id-type="pmid">29987051</article-id><article-id pub-id-type="publisher-id">201805681</article-id><article-id pub-id-type="doi">10.1073/pnas.1805681115</article-id><article-categories><subj-group subj-group-type="heading"><subject>Physical Sciences</subject><subj-group><subject>Statistics</subject></subj-group></subj-group><subj-group subj-group-type="heading"><subject>Biological Sciences</subject><subj-group><subject>Genetics</subject></subj-group></subj-group></article-categories><title-group><article-title>Integrative analysis of single-cell genomics data by coupled nonnegative matrix factorizations</article-title></title-group><contrib-group><contrib contrib-type="author"><contrib-id contrib-id-type="orcid" authenticated="false">http://orcid.org/0000-0003-4685-811X</contrib-id><name><surname>Duren</surname><given-names>Zhana</given-names></name><xref ref-type="aff" rid="aff1"><sup>a</sup></xref><xref ref-type="aff" rid="aff2"><sup>b</sup></xref><xref ref-type="author-notes" rid="fn1"><sup>1</sup></xref></contrib><contrib contrib-type="author"><name><surname>Chen</surname><given-names>Xi</given-names></name><xref ref-type="aff" rid="aff1"><sup>a</sup></xref><xref ref-type="aff" rid="aff2"><sup>b</sup></xref><xref ref-type="author-notes" rid="fn1"><sup>1</sup></xref></contrib><contrib contrib-type="author"><name><surname>Zamanighomi</surname><given-names>Mahdi</given-names></name><xref ref-type="aff" rid="aff1"><sup>a</sup></xref><xref ref-type="aff" rid="aff2"><sup>b</sup></xref><xref ref-type="aff" rid="aff3"><sup>c</sup></xref><xref ref-type="author-notes" rid="fn1"><sup>1</sup></xref></contrib><contrib contrib-type="author"><name><surname>Zeng</surname><given-names>Wanwen</given-names></name><xref ref-type="aff" rid="aff1"><sup>a</sup></xref><xref ref-type="aff" rid="aff2"><sup>b</sup></xref><xref ref-type="aff" rid="aff4"><sup>d</sup></xref></contrib><contrib contrib-type="author"><name><surname>Satpathy</surname><given-names>Ansuman T.</given-names></name><xref ref-type="aff" rid="aff3"><sup>c</sup></xref></contrib><contrib contrib-type="author"><name><surname>Chang</surname><given-names>Howard Y.</given-names></name><xref ref-type="aff" rid="aff3"><sup>c</sup></xref></contrib><contrib contrib-type="author"><name><surname>Wang</surname><given-names>Yong</given-names></name><xref ref-type="aff" rid="aff5"><sup>e</sup></xref><xref ref-type="aff" rid="aff6"><sup>f</sup></xref></contrib><contrib contrib-type="author"><name><surname>Wong</surname><given-names>Wing Hung</given-names></name><xref ref-type="aff" rid="aff1"><sup>a</sup></xref><xref ref-type="aff" rid="aff2"><sup>b</sup></xref><xref ref-type="aff" rid="aff3"><sup>c</sup></xref><xref ref-type="corresp" rid="cor1"><sup>2</sup></xref></contrib><aff id="aff1"><sup>a</sup>Department of Statistics, <institution>Stanford University</institution>, Stanford, <addr-line>CA</addr-line> 94305;</aff><aff id="aff2"><sup>b</sup>Department of Biomedical Data Science, <institution>Stanford University</institution>, Stanford, <addr-line>CA</addr-line> 94305;</aff><aff id="aff3"><sup>c</sup>Center for Personal Dynamic Regulomes, <institution>Stanford University</institution>, Stanford, <addr-line>CA</addr-line> 94305;</aff><aff id="aff4"><sup>d</sup>Ministry of Education Key Laboratory of Bioinformatics, Bioinformatics Division and Center for Synthetic &#x00026; Systems Biology, Department of Automation, <institution>Tsinghua University</institution>, 100084 Beijing, <country>China</country>;</aff><aff id="aff5"><sup>e</sup>Academy of Mathematics and Systems Science, <institution>Chinese Academy of Sciences</institution>, 100080 Beijing, <country>China</country>;</aff><aff id="aff6"><sup>f</sup>Center for Excellence in Animal Evolution and Genetics, <institution>Chinese Academy of Sciences</institution>, 650223 Kunming, <country>China</country></aff></contrib-group><author-notes><corresp id="cor1"><sup>2</sup>To whom correspondence should be addressed. Email: <email>whwong@stanford.edu</email>.</corresp><fn fn-type="edited-by"><p>Contributed by Wing Hung Wong, June 14, 2018 (sent for review April 4, 2018; reviewed by Andrew D. Smith and Nancy R. Zhang)</p></fn><fn fn-type="con"><p>Author contributions: H.Y.C., Y.W., and W.H.W. designed research; Z.D., X.C., W.Z., and A.T.S. performed research; Z.D., M.Z., and W.H.W. analyzed data; and Z.D., M.Z., and W.H.W. wrote the paper.</p></fn><fn fn-type="con"><p>Reviewers: A.D.S., University of Southern California; and N.R.Z., University of Pennsylvania.</p></fn><fn fn-type="equal" id="fn1"><p><sup>1</sup>Z.D., X.C., and M.Z. contributed equally to this work.</p></fn></author-notes><pub-date pub-type="ppub"><day>24</day><month>7</month><year>2018</year></pub-date><pub-date pub-type="epub"><day>9</day><month>7</month><year>2018</year></pub-date><pub-date pub-type="pmc-release"><day>9</day><month>7</month><year>2018</year></pub-date><!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. --><volume>115</volume><issue>30</issue><fpage>7723</fpage><lpage>7728</lpage><permissions><copyright-statement>Copyright &#x000a9; 2018 the Author(s). Published by PNAS.</copyright-statement><copyright-year>2018</copyright-year><license license-type="open-access" xlink:href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="vor"/><license-p>This open access article is distributed under <ext-link ext-link-type="uri" xlink:href="https://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives License 4.0 (CC BY-NC-ND)</ext-link>.</license-p></license></permissions><self-uri xlink:title="pdf" xlink:href="pnas.201805681.pdf"/><abstract abstract-type="executive-summary"><title>Significance</title><p>Biological samples are often heterogeneous mixtures of different types of cells. Suppose we have two single-cell datasets, each providing information on a different cellular feature and generated on a different sample from this mixture. Then, the clustering of cells in the two samples should be coupled as both clusterings are reflecting the underlying cell types in the same mixture. This &#x0201c;coupled clustering&#x0201d; problem is a new problem not covered by existing clustering methods. In this paper, we develop an approach for its solution based on the coupling of two nonnegative matrix factorizations. The method should be useful for integrative single-cell genomics analysis tasks such as the joint analysis of single-cell RNA-sequencing and single-cell ATAC-sequencing data.</p></abstract><abstract><p>When different types of functional genomics data are generated on single cells from different samples of cells from the same heterogeneous population, the clustering of cells in the different samples should be coupled. We formulate this &#x0201c;coupled clustering&#x0201d; problem as an optimization problem and propose the method of coupled nonnegative matrix factorizations (coupled NMF) for its solution. The method is illustrated by the integrative analysis of single-cell RNA-sequencing (RNA-seq) and single-cell ATAC-sequencing (ATAC-seq) data.</p></abstract><kwd-group><kwd>coupled clustering</kwd><kwd>NMF</kwd><kwd>single-cell genomic data</kwd></kwd-group><funding-group><award-group id="gs1"><funding-source id="sp1">HHS | National Institutes of Health (NIH)<named-content content-type="funder-id">100000002</named-content></funding-source><award-id rid="sp1">R01HG007834</award-id><principal-award-recipient>Wing Hung Wong</principal-award-recipient></award-group><award-group id="gs2"><funding-source id="sp2">HHS | National Institutes of Health (NIH)<named-content content-type="funder-id">100000002</named-content></funding-source><award-id rid="sp2">R01GM109836</award-id><principal-award-recipient>Wing Hung Wong</principal-award-recipient></award-group><award-group id="gs3"><funding-source id="sp3">HHS | National Institutes of Health (NIH)<named-content content-type="funder-id">100000002</named-content></funding-source><award-id rid="sp3">P50HG007735</award-id><principal-award-recipient>Wing Hung Wong</principal-award-recipient></award-group></funding-group><counts><page-count count="6"/></counts></article-meta></front><body><p content-type="flushleft">Biological samples of interest in clinical or experimental studies are often heterogeneous mixtures; i.e., a sample may consist of many subpopulations of cells with distinct cellular states. To resolve the heterogeneity and to characterize the constituent subpopulations, it is necessary to generate functional genomic data at the single-cell level. An exciting recent development in genomics technology has been the emergence of methods for single-cell (sc) measurements; for example, scRNA sequencing (scRNA-seq) (<xref rid="r1" ref-type="bibr">1</xref>) enables transcription profiling, scATAC sequencing (scATAC-seq) (<xref rid="r2" ref-type="bibr">2</xref>) identifies accessible chromatin regions, and sc-bisulfite sequencing (<xref rid="r3" ref-type="bibr">3</xref>) measures DNA methylation, all at the single-cell level.</p><p>Often, the first step in the analysis of single-cell data is clustering, that is, to classify cells into the constituent subpopulations. Clustering methods for scRNA-seq data are discussed in refs. <xref rid="r4" ref-type="bibr">4</xref> and <xref rid="r5" ref-type="bibr">5</xref>, and clustering of scATAC-seq data is described in ref. <xref rid="r6" ref-type="bibr">6</xref>. Existing methods, however, do not address the increasingly common situation where two or more types of sc-genomics experiments are performed on different subsamples from the same cell population. For example, <xref ref-type="fig" rid="fig01">Fig. 1<italic>A</italic></xref> depicts the situation when one subsample is analyzed by scRNA-seq while another is analyzed by scATAC-seq. Although the clustering methods developed for scRNA-seq and scATAC-seq were each shown to be capable of identifying distinct cell types, the association of gene expression changes to chromatin accessibility dynamics better defines cell types and lineages, especially in complex tissues (<xref rid="r7" ref-type="bibr">7</xref>, <xref rid="r8" ref-type="bibr">8</xref>). To connect these two assays, one might suggest to separately cluster each data type, followed by an integration afterward. However, such approaches can be problematic because scATAC-seq and scRNA-seq data do not always possess a similar power for detection of cell types (<xref rid="r9" ref-type="bibr">9</xref>). Furthermore, clusters may be data type specific due to technical noise. So it is advantageous to systematically couple the two clustering processes in such a way that the clustering of the cells in the scRNA-seq sample can also make use of information from the scATAC-seq sample, and vice versa (<xref rid="r10" ref-type="bibr">10</xref>). In this paper, we formulate this &#x0201c;coupled clustering&#x0201d; problem as an optimization problem and introduce a method, named coupled nonnegative matrix factorizations (coupled NMF), for its solution.</p><fig id="fig01" fig-type="featured" orientation="portrait" position="float"><label>Fig. 1.</label><caption><p>Overview of the coupled-clustering method. (<italic>A</italic>) Single-cell gene expression and single-cell chromatin accessibility data. (<italic>B</italic>) Learning coupling matrix from public data. (<italic>C</italic>) Coupled clustering model. (<italic>D</italic>) Cluster-specific gene expression and chromatin accessibility.</p></caption><graphic id="gra1" xlink:href="pnas.1805681115fig01"/></fig><sec id="s1"><title>Approach</title><sec id="s2"><title>Coupled NMF.</title><p>We first introduce our approach in general terms. Let <italic>O</italic> be a <italic>p</italic><sub>1</sub> by <italic>n</italic><sub>1</sub> matrix representing data on <italic>p</italic><sub>1</sub> features for <italic>n</italic><sub>1</sub> units in the first sample; then a &#x0201c;soft&#x0201d; clustering of the units in this sample can be obtained from a nonnegative factorization <italic>O = W</italic><sub>1</sub><italic>H</italic><sub>1</sub> as follows: The <italic>i</italic>th column of <italic>W</italic><sub>1</sub> gives the mean vector for the <italic>i</italic>th cluster of units, while the <italic>j</italic>th column of <italic>H</italic><sub>1</sub> gives the assignment weights of the <italic>j</italic>th unit to the different clusters. Similarly, clustering of the second sample can be obtained from the factorization <italic>E = W</italic><sub>2</sub><italic>H</italic><sub>2</sub>, where <italic>E</italic> is the <italic>p</italic><sub>2</sub> by <italic>n</italic><sub>2</sub> matrix of data on <italic>p</italic><sub>2</sub> features (which are different from the features measured in the first sample) for <italic>n</italic><sub>2</sub> units in the second sample. To couple two matrix factorizations, we introduce a term <inline-formula><mml:math id="i1"><mml:mrow><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>W</mml:mi><mml:mn>2</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:mi>A</mml:mi><mml:msub><mml:mi>W</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> where <italic>A</italic> is a &#x0201c;coupling matrix.&#x0201d; The construction of <italic>A</italic> is application specific but depends on the assumption that, based on scientific understanding or prior data, it is possible to identify a subset of features in one sample that are linearly predictable from the features measured in the other sample. In such a situation, we can take <italic>A</italic> to be the matrix representation of the linear prediction operator.</p><p>Once the coupling is defined this way, we can obtain the factorizations of the two data matrices by solving the following optimization problem (<xref ref-type="fig" rid="fig01">Fig. 1<italic>C</italic></xref>):<disp-formula id="eq1"><mml:math id="me1"><mml:mrow><mml:msub><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>&#x02009;</mml:mo><mml:msub><mml:mi>H</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>H</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>&#x02265;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msubsup><mml:mrow><mml:mrow><mml:mo>&#x02016;</mml:mo><mml:mrow><mml:mi>O</mml:mi><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:msub><mml:mi>H</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>&#x02016;</mml:mo></mml:mrow></mml:mrow><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>&#x003bb;</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:mfrac><mml:msubsup><mml:mrow><mml:mrow><mml:mo>&#x02016;</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:msub><mml:mi>H</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>&#x02016;</mml:mo></mml:mrow></mml:mrow><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>&#x003bb;</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mi>t</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>W</mml:mi><mml:mn>2</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:mi>A</mml:mi><mml:msub><mml:mi>W</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:mi>&#x003bc;</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mrow><mml:mo>&#x02016;</mml:mo><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>&#x02016;</mml:mo></mml:mrow></mml:mrow><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mrow><mml:mo>&#x02016;</mml:mo><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>&#x02016;</mml:mo></mml:mrow></mml:mrow><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math><label>[1]</label></disp-formula>There are three tuning parameters: <inline-formula><mml:math id="i2"><mml:mrow><mml:msub><mml:mi>&#x003bb;</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula>
<inline-formula><mml:math id="i3"><mml:mrow><mml:msub><mml:mi>&#x003bb;</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="i4"><mml:mrow><mml:mi>&#x003bc;</mml:mi><mml:mo>.</mml:mo></mml:mrow></mml:math></inline-formula> The first two terms are clustering the two samples. The third term is to induce the consistency of features from the second sample with linear transformed features from the first sample. The fourth term controls the growth of <italic>W</italic><sub>1</sub> and <italic>W</italic><sub>2</sub>. After solving the optimization, the cluster profile and the cluster assignments for the <italic>k</italic>th cluster in the first sample can be obtained respectively from the <italic>k</italic>th column of <italic>W</italic><sub>1</sub> and the <italic>k</italic>th row of <italic>H</italic><sub>1</sub>. Similarly, the clustering in the second sample can be obtained from <italic>W</italic><sub>2</sub> and <italic>H</italic><sub>2</sub> (<xref ref-type="fig" rid="fig01">Fig. 1<italic>D</italic></xref>).</p></sec><sec id="s3"><title>Application in Single-Cell Genomic Data.</title><p>We apply the coupled NMF approach to cluster scRNA-seq and scATAC-seq data. In this application, <inline-formula><mml:math id="i5"><mml:mrow><mml:msub><mml:mi>O</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> denotes the degree of openness (i.e., accessibility) of the <italic>i</italic>th region in the <italic>j</italic>th cell (<xref rid="r6" ref-type="bibr">6</xref>). By a region we mean either a predefined regulatory element (RE) or a peak called from merged scATAC-seq data. From scRNA-seq data, we compute the data matrix <italic>E</italic> where <inline-formula><mml:math id="i6"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> denotes the expression level of the <italic>g</italic>th gene in the <italic>h</italic>th cell (<xref rid="r11" ref-type="bibr">11</xref>). Details are given in <xref ref-type="sec" rid="s10"><italic>Materials and Methods</italic></xref>, Data Processing. Note that the scATAC-seq and the scRNA-seq data are not measured in the same cell (<xref ref-type="fig" rid="fig01">Fig. 1<italic>A</italic></xref>).</p><p>To get the coupling matrix <italic>A</italic>, we take advantage of our recent work on modeling paired gene expression and chromatin accessibility data (<xref rid="r7" ref-type="bibr">7</xref>) and use a diverse panel of cell lines with both expression and accessibility data to train a prediction model of gene expression from accessibility (see <xref ref-type="sec" rid="s10"><italic>Materials and Methods</italic></xref> for details). After fitting the model, we select a set of &#x0201c;well-predicted&#x0201d; genes (named gene set <italic>S</italic>) and use this set of genes&#x02019; RE&#x02013;gene associations to couple the two types of data. In this application, <italic>AW</italic><sub>1</sub> gives the cluster-specific predictions of the expression of genes based on the cluster-specific accessibilities of REs, and hence the trace term enforces our expectation that the expression of genes should be consistent with the predictions based on accessibility of REs. As the coupling matrix <italic>A</italic> is noisy, we can refine the coupling iteratively, as follows, to get a better result. We assign single cells to clusters according to the assignment weights given by <italic>H</italic><sub>1</sub> and <italic>H</italic><sub>2</sub>. After getting the cluster results, we choose cluster-specific genes based on scRNA-seq clustering. We restrict the rows of <italic>A</italic> and <italic>W</italic><sub>2</sub> to the cluster-specific genes and get a submatrix of <inline-formula><mml:math id="i7"><mml:mrow><mml:mover accent="true"><mml:mi>A</mml:mi><mml:mo>&#x0223c;</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> of <italic>A</italic> and <inline-formula><mml:math id="i8"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo stretchy="true">&#x0223c;</mml:mo></mml:mover></mml:mrow></mml:math></inline-formula> of <italic>W</italic><sub>2</sub>. Then we replace the <italic>A</italic> and <italic>W</italic><sub>2</sub> in the trace term by the submatrices and recluster the cells by optimizing the objective function in <xref ref-type="disp-formula" rid="eq1">Eq. <bold>1</bold></xref>. We continue until the cluster assignments are not changed by further iterations.</p></sec></sec><sec sec-type="results" id="s4"><title>Results</title><sec id="s5"><title>Results on Simulation Data.</title><p>We first evaluate the performance of our method in a simulation study. Single-cell datasets are simulated by sampling reads from a bulk dataset (<xref ref-type="sec" rid="s10"><italic>Materials and Methods</italic></xref>). The bulk datasets used in our simulation study are from two very similar cell types from a hematopoietic differentiation process, namely common myeloid progenitor (CMP) and megakaryocyte erythroid progenitor (MEP) (<xref rid="r12" ref-type="bibr">12</xref>). For each of these two cell types, we first generated 100 scRNA-seq datasets and 100 scATAC-seq datasets (<xref ref-type="sec" rid="s10"><italic>Materials and Methods</italic></xref>).</p><p>To simulate a scRNA-seq dataset from a mixed population with two cell types, we simply mix the 200 scRNA-seq data from two cell lines together and treat them as a single scRNA-seq dataset. We apply <italic>k</italic>-means and NMF to cluster the mixed cells. We run <italic>k</italic>-means 50 times with different random initial values and choose the result that gives the minimum total sum of within-cluster distances. Similarly, we run NMF 50 times and choose the result that gives the minimum approximation error in the Frobenius norm. The results of all 50 runs on scRNA-seq and scATAC-seq data by <italic>k</italic>-means and NMF are shown in <ext-link ext-link-type="uri" xlink:href="http://www.pnas.org/lookup/suppl/doi:10.1073/pnas.1805681115/-/DCSupplemental" xlink:show="new"><italic>SI Appendix</italic>, Fig. S1</ext-link>. Finally, we perform coupled NMF clustering based on both the 200-cell mixture of the scRNA-seq sample and the 200-cell mixture of the scATAC-seq sample (<ext-link ext-link-type="uri" xlink:href="http://www.pnas.org/lookup/suppl/doi:10.1073/pnas.1805681115/-/DCSupplemental" xlink:show="new"><italic>SI Appendix</italic>, Fig. S3</ext-link>). The performance of the three clustering results (<italic>k</italic>-means on scRNA-seq only, NMF on scRNA-seq only, and coupled NMF on both scRNA-seq and scATAC-seq) is presented in <xref ref-type="fig" rid="fig02">Fig. 2<italic>A</italic></xref>. A similar comparison on the clustering results of scATAC-seq is illustrated in <xref ref-type="fig" rid="fig02">Fig. 2<italic>B</italic></xref>. The convergence of coupled NMF is given in <ext-link ext-link-type="uri" xlink:href="http://www.pnas.org/lookup/suppl/doi:10.1073/pnas.1805681115/-/DCSupplemental" xlink:show="new"><italic>SI Appendix</italic>, Fig. S2</ext-link>. It is seen that coupling leads to greatly improved results, reducing the assignment error rate by more than threefold over the other two methods (<xref ref-type="fig" rid="fig02">Fig. 2<italic>C</italic></xref>).</p><fig id="fig02" fig-type="figure" orientation="portrait" position="float"><label>Fig. 2.</label><caption><p>(<italic>A</italic>) Clustering results of <italic>k</italic>-means, NMF, and our coupled clustering on simulation scRNA-seq data of CMP and MEP. (<italic>B</italic>) Clustering results of <italic>k</italic>-means, NMF, and our coupled clustering on simulation scATAC-seq data of CMP and MEP. (<italic>C</italic>) Comparison of <italic>k</italic>-means, NMF, and coupled clustering on simulation data of CMP and MEP.</p></caption><graphic id="gra2" xlink:href="pnas.1805681115fig02"/></fig></sec><sec id="s6"><title>Assessment of Prediction Model Before Coupling.</title><p>We are interested in applying coupled NMF to analyze data generated from differentiation of a mouse embryonic stem cell, namely scRNA-seq and scATAC-seq at day 4 after retinoic acid (RA) treatment (<xref ref-type="sec" rid="s10"><italic>Materials and Methods</italic></xref>). Before analyzing the single-cell data, we want to assess whether the model learned from the diverse panel (i.e., matrix <italic>A</italic>) provides reliable predictive power to connect chromatin accessibility and gene expression in this biological context. We thus generated bulk RNA-seq and ATAC-seq at day 4 of the RA treatment (named RA day 4). Using the model trained on the diverse panel, we predicted the expression of genes in set <italic>S</italic> at RA day 4. <ext-link ext-link-type="uri" xlink:href="http://www.pnas.org/lookup/suppl/doi:10.1073/pnas.1805681115/-/DCSupplemental" xlink:show="new"><italic>SI Appendix</italic>, Fig. S3</ext-link> shows the observed vs. predicted gene expressions. It is seen that genes in <italic>S</italic> were predicted with high accuracy (<italic>R</italic><sup>2</sup> = 0.75, <italic>r</italic> = 0.87). This gives us confidence in using the model to initiate the coupling.</p></sec><sec id="s7"><title>Results on Real Single-Cell Data.</title><p>Next, we use coupled NMF to analyze RA day-4 scRNA-seq and scATAC-seq data. We first perform coupled NMF with <italic>K</italic> = 2 (i.e., two clusters) and then visualize the clustering result on Spearman correlation-based t-distributed stochastic neighbor embedding (t-SNE) plots. There are clearly two separated clusters in both t-SNE plots of scATAC-seq and scRNA-seq. Increasing the number of clusters to three, we can see three well-separated clusters in t-SNE plots. However, when <italic>K</italic> is increased to 4 or 5, the separation among clusters is no longer clear (<xref ref-type="fig" rid="fig03">Fig. 3<italic>A</italic></xref> and <ext-link ext-link-type="uri" xlink:href="http://www.pnas.org/lookup/suppl/doi:10.1073/pnas.1805681115/-/DCSupplemental" xlink:show="new"><italic>SI Appendix</italic>, Fig. S4</ext-link>). We also calculate clustering stability based on the method in Brunet et al. (<xref rid="r13" ref-type="bibr">13</xref>) for <italic>K</italic> = 2&#x02013;5 (<ext-link ext-link-type="uri" xlink:href="http://www.pnas.org/lookup/suppl/doi:10.1073/pnas.1805681115/-/DCSupplemental" xlink:show="new"><italic>SI Appendix</italic>, Fig. S5</ext-link>). The results show that clustering results are stable when <italic>K</italic> = 2 or 3, while the results are not stable when <italic>K</italic> is increased to 4 or 5. Hence, we set <italic>K</italic> = 3 for the remaining of the analysis.</p><fig id="fig03" fig-type="figure" orientation="portrait" position="float"><label>Fig. 3.</label><caption><p>(<italic>A</italic>) t-SNE plot of scRNA-seq data (<italic>Right</italic>) and scATAC-seq data (<italic>Left</italic>) from RA day 4. Different colors represent clustering assignment from the coupled-clustering method. (<italic>B</italic>) Same t-SNE plots as in <italic>A</italic>. Different colors represent cluster-specific TFs&#x02019; (Ebf1, Gata4, and Rfx4) gene expression <italic>Z</italic> score and motif activity <italic>Z</italic> score. (<italic>C</italic>) Comparison of cluster-specific TFs&#x02019; expression <italic>Z</italic> score with motif activity <italic>Z</italic> score at the cluster level. (<italic>D</italic>) Overlap of cluster-specific peaks nearby genes with cluster-specific genes. The values represent Fisher&#x02019;s exact test <italic>P</italic> value and fold change.</p></caption><graphic id="gra3" xlink:href="pnas.1805681115fig03"/></fig><p>For each of the three clusters, we identify cluster-specific transcription factors (TFs) based on their expression from RNA-seq data and compare their motif activities in scATAC-seq data (<xref ref-type="fig" rid="fig03">Fig. 3</xref>). Here the motif activity of a TF in a cell reflects the enrichment level of the TF&#x02019;s motif in accessible REs in a scATAC-seq dataset (<xref ref-type="sec" rid="s10"><italic>Materials and Methods</italic></xref>). <xref ref-type="fig" rid="fig03">Fig. 3<italic>B</italic></xref> shows the motif activities and expressions of some cluster-specific TFs on the t-SNE plots (<xref ref-type="fig" rid="fig03">Fig. 3<italic>B</italic></xref> and <ext-link ext-link-type="uri" xlink:href="http://www.pnas.org/lookup/suppl/doi:10.1073/pnas.1805681115/-/DCSupplemental" xlink:show="new"><italic>SI Appendix</italic>, Fig. S6</ext-link>). <xref ref-type="fig" rid="fig03">Fig. 3<italic>C</italic></xref> shows the heat maps of motif activities and expressions for a subset of cluster-specific TFs, namely those with expression transcripts per million (TPM) greater than 10 in at least 40 cells. It is seen that cluster-1&#x02013;specific TFs (e.g., Ebf1, Lhx1, and Neurod1) have high motif activities in the corresponding cluster of the scATAC-seq sample. Similarly, cluster-2&#x02013;specific TFs, Gata4, Foxa2, and Jun, have high motif activity in cluster 2 and cluster-3&#x02013;specific TFs, Rfx4, Sox2, Sox9, Pou3f2, and Pou3f4, have high motif activity in cluster 3. This result shows that our method leads to highly consistent TF expression and TF motif activities within each of the inferred constituent subpopulations.</p><p>To further assess the coupled NMF results, we select cluster-specific genes from RNA-seq data and cluster-specific peaks from ATAC-seq data. We test whether the cluster-specific genes from scRNA-seq data are significantly overlapped with the genes with nearby (100 kb) cluster-specific ATAC-seq peaks by performing Fisher&#x02019;s exact test based on the overlap of two sets of genes (<ext-link ext-link-type="uri" xlink:href="http://www.pnas.org/lookup/suppl/doi:10.1073/pnas.1805681115/-/DCSupplemental" xlink:show="new"><italic>SI Appendix</italic>, Fig. S7</ext-link>). <xref ref-type="fig" rid="fig03">Fig. 3<italic>D</italic></xref> gives the <italic>P</italic> values for all possible pairings of the RNA-seq clusters with ATAC-seq clusters. It is seen that the pairings identified by coupled NMF indeed gave dramatically more significant <italic>P</italic> values and higher fold changes than the other possible pairings.</p></sec><sec id="s8"><title>Coupled Clustering of Single Cells Sheds Light on Stem Cell Differentiation.</title><p>The cluster-specific gene expression profiles and chromatin accessibility profiles provided by our method can provide useful insight into the constituent subpopulations. First, we use cluster-specific peaks from scATAC-seq data to annotate the clusters. We collect previously determined enhancers in mouse tissues at seven developmental stages from 11.5 d postconception until birth (<xref rid="r14" ref-type="bibr">14</xref>). <xref ref-type="fig" rid="fig04">Fig. 4 <italic>A</italic>&#x02013;<italic>C</italic></xref> shows the degree of overlap of our cluster-specific peaks with these developmental enhancers for different tissues and at different developmental stages. The number represents 10,000 times the Jaccard index (intersection over union) and NA indicates that enhancer data for that tissue in that stage are not available. The results show that cluster-1&#x02013;specific peaks are enriched in forebrain and midbrain enhancers at E12.5 and E13.5. Cluster-2&#x02013;specific peaks are enriched in heart enhancers at E15.5 and E16.5. Cluster-3&#x02013;specific peaks are enriched in forebrain enhancers from E12.5 to E16.5 and also in midbrain, hindbrain, and neural tube. In addition, we also collect experimentally validated tissue-specific enhancers from the VISTA database (<ext-link ext-link-type="uri" xlink:href="https://enhancer.lbl.gov/" xlink:show="new">https://enhancer.lbl.gov/</ext-link>) and overlap them to cluster-specific peaks. <xref ref-type="fig" rid="fig04">Fig. 4<italic>D</italic></xref> shows the percentage of tissue-specific VISTA enhancers overlapped to cluster-specific peaks. Only those tissues with at least one enhancer overlapping with the cluster-specific peaks are shown. Enhancers from nervous system-associated tissue (neural tube, cranial nerve, hind brain, midbrain, forebrain, trigeminal V, dorsal root ganglion, eye, nose) have overlap with cluster-specific peaks from cluster 1 and cluster 3. Cluster-2&#x02013;specific peaks are enriched in blood vessel enhancers and heart enhancers. These results suggest that clusters 1 and 3 may be related to nervous system tissues and cluster 2 may be related to heart tissue.</p><fig id="fig04" fig-type="figure" orientation="portrait" position="float"><label>Fig. 4.</label><caption><p>(<italic>A</italic>&#x02013;<italic>C</italic>) Similarity of cluster-specific peaks with enhancers of 12 tissues&#x02019; seven developmental stages. The numbers represent 10,000&#x000d7; Jaccard index and NA indicates enhancer data of that tissue in that stage are not available. (<italic>D</italic>) Percentage of VISTA enhancer that overlapped with cluster-specific peaks. (<italic>E</italic>) GO enrichment of cluster-specific genes.</p></caption><graphic id="gra4" xlink:href="pnas.1805681115fig04"/></fig><p>Next, we analyzed cluster-specific genes from scRNA-seq data. <xref ref-type="fig" rid="fig04">Fig. 4<italic>E</italic></xref> presents the most enriched gene ontology (GO) terms, their <italic>P</italic> values, and fold changes in each cluster. The results show that cluster 2 is enriched in blood vessel development and cardiovascular system development, while clusters 1 and 3 are enriched in nervous system-associated terms. The results from scRNA-seq&#x02013;based annotation are consistent with the results from scATAC-seq&#x02013;based analysis. Although clusters 1 and 3 are nervous system-associated clusters, there are interesting differences. Cluster 1 is more enriched in axon guidance and neuron projection guidance, while cluster 3 is more enriched in brain development and oligodendrocytes differentiation. It seems cluster 1 is related to neuron-specific development and cluster 3 is more related to general nervous system development. Overall our results suggest that the RA-induced stem cell at day 4 is a mixture of cells related to neuron, cardiovascular system, and nervous system. These results are largely consistent with previous studies (<xref rid="r15" ref-type="bibr">15</xref>, <xref rid="r16" ref-type="bibr">16</xref>).</p><p>We can construct cluster-specific gene regulatory networks as graphs with directed edges from the cluster-specific peaks to the cluster-specific genes that are within 100 kb distance and directed edges from cluster-specific TFs to cluster-specific peaks containing significant matches to the corresponding motifs. These cluster-specific subnetworks are presented in <ext-link ext-link-type="uri" xlink:href="http://www.pnas.org/lookup/suppl/doi:10.1073/pnas.1805681115/-/DCSupplemental" xlink:show="new"><italic>SI Appendix</italic>, Fig. S8</ext-link>. It is seen that Klf7, Ebf1, Sox11, and Nhlh1 are playing an important role in the network for cluster 1; Gata4, Gata6, Sox17, Foxa2, Ap1 complex, and Tead family are important in cluster 2; and Rarb, Nr2f1, Rfx4, Sox2, Sox9, Sox21, Pou3f2, Pou3f3, and Pou3f4 are important in cluster 3.</p></sec></sec><sec sec-type="discussion" id="s9"><title>Discussion</title><p content-type="flushleft">In this paper, we proposed a coupled clustering method and applied it to single-cell genomic data. We emphasize that the measurement of multiple data types in the same cell is technically challenging due to the complex cellular reactions. Our method utilizes external information to integrate gene expression and chromatin accessibility that are not measured on the same cell. In the simulation study, we showed that the coupled NMF outperforms clustering results derived from just one data type. Moreover, we showed that our method identifies important peaks and genes that characterize cellular heterogeneity in the context of the RA-induced stem cell. The proposed method enables a systematic mapping of peaks to genes, informative for downstream analysis such as inferring gene regulatory networks at the single-cell level.</p><p>As far as we know, coupled clustering is a problem different from other complex clustering tasks such as biclustering or multiview clustering. Biclustering (<xref rid="r17" ref-type="bibr">17</xref><xref rid="r18" ref-type="bibr"/>&#x02013;<xref rid="r19" ref-type="bibr">19</xref>), also called block clustering or coclustering, has been used widely to cluster subjects and cluster genes simultaneously based on a <italic>p</italic> by <italic>n</italic> data matrix of expression measurements on <italic>p</italic> genes for <italic>n</italic> subjects. The same data matrix is used in the clustering in gene space as well as the clustering in subject space. In contrast, two different data matrices are used in coupled clustering of two separate samples. In multiview clustering (<xref rid="r20" ref-type="bibr">20</xref>), the set of features measured on each subject can be divided into two independent subsets; for example, one of them may represent gene expression measurements while the other represent accessibility measurements. The important difference between multiview clustering and coupled clustering is that in the former setting all features are measured on each subject, whereas in the latter one only one of the subsets can be measured on any subject. Clearly, coupled clustering is a more challenging task and requires external information such as subject domain knowledge or prior data to initialize the coupling.</p></sec><sec sec-type="materials|methods" id="s10"><title>Materials and Methods</title><sec id="s11"><title>Construction of Data Matrices.</title><p>From scATAC-seq data, we compute a data matrix <italic>O</italic>, where <inline-formula><mml:math id="i9"><mml:mrow><mml:msub><mml:mi>O</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> denotes the degree of openness (i.e., read count) of the <italic>i</italic>th region in the <italic>j</italic>th cell (<xref rid="r6" ref-type="bibr">6</xref>). By region we mean union of predefined REs and peaks. From scRNA-seq data, we compute the data matrix <italic>E</italic> where <inline-formula><mml:math id="i10"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula> denotes the expression level of the <italic>g</italic>th gene in the <italic>h</italic>th cell (<xref rid="r11" ref-type="bibr">11</xref>). Details are given in <xref ref-type="sec" rid="s10"><italic>Materials and Methods</italic></xref>, <italic>Data Processing</italic>. Note that the scATAC-seq and the scRNA-seq data are not measured in the same cell (<xref ref-type="fig" rid="fig01">Fig. 1<italic>A</italic></xref>).</p></sec><sec id="s12"><title>Construction of Coupling Matrix.</title><p>Our approach to the contraction of <italic>A</italic> is to look for a subset of genes whose expression is highly predictable from chromatin accessibility of REs. To do this, we take advantage of our recent work on modeling paired gene expression and chromatin accessibility data (on bulk samples) across diverse cellular contexts (<xref rid="r7" ref-type="bibr">7</xref>). From the paired expression and chromatin accessibility (PECA) model in that work, for each gene <italic>g</italic>, we can extract a set <italic>S</italic><sub><italic>g</italic></sub> of REs that regulate that gene. We consider the regression model of target gene (TG) expression (denoted as <inline-formula><mml:math id="i11"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>) on its REs&#x02019; accessibility (denoted as <inline-formula><mml:math id="i12"><mml:mrow><mml:msub><mml:mi>O</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula>):<disp-formula id="eq2"><mml:math id="me2"><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>&#x003b1;</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>&#x02208;</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mi>&#x003b1;</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mi>O</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle><mml:mo>.</mml:mo></mml:mrow></mml:math><label>[2]</label></disp-formula></p><p content-type="flushleft">We estimate the parameter <italic>&#x003b1;</italic><sub><italic>g</italic></sub> by fitting the penalized least-squares problem (<xref ref-type="disp-formula" rid="eq3">Eq. <bold>3</bold></xref>) based on expression and accessibility data on a diverse panel of cell lines [56 cell lines in the case of mouse and 148 cell lines in the case of human (<ext-link ext-link-type="uri" xlink:href="http://www.pnas.org/lookup/suppl/doi:10.1073/pnas.1805681115/-/DCSupplemental" xlink:show="new">Dataset S1</ext-link>)],<disp-formula id="eq3"><mml:math id="me3"><mml:mrow><mml:msub><mml:mrow><mml:mi>min</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mi>&#x003b1;</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>&#x02009;</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:msubsup><mml:mrow><mml:mrow><mml:mo>&#x02016;</mml:mo><mml:mrow><mml:msub><mml:mi>E</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>&#x003b1;</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>&#x02212;</mml:mo><mml:mstyle displaystyle="true"><mml:msub><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>&#x02208;</mml:mo><mml:msub><mml:mi>S</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:msub><mml:mi>&#x003b1;</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle><mml:msub><mml:mi>O</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>&#x02016;</mml:mo></mml:mrow></mml:mrow><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:mi>&#x003b4;</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>&#x02016;</mml:mo><mml:mrow><mml:msub><mml:mi>&#x003b1;</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow><mml:mo>&#x02016;</mml:mo></mml:mrow></mml:mrow><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mrow><mml:mo>&#x02016;</mml:mo><mml:mrow><mml:msub><mml:mi>&#x003b1;</mml:mi><mml:mi>g</mml:mi></mml:msub></mml:mrow><mml:mo>&#x02016;</mml:mo></mml:mrow></mml:mrow><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math><label>[3]</label></disp-formula></p><p content-type="flushleft">where <inline-formula><mml:math id="i13"><mml:mi>&#x003b4;</mml:mi></mml:math></inline-formula> is determined by fivefold cross-validation. After fitting the model, we select a set of well-predicted genes for which regression <italic>R</italic><sup>2</sup> is greater than 0.8. In this way, we selected 5,966 well-predicted genes in mouse and selected 6,253 well-predicted genes in human. In coupling matrix <italic>A =</italic> (<inline-formula><mml:math id="i14"><mml:mrow><mml:msub><mml:mi>&#x003b1;</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></inline-formula>), only the rows corresponding to the selected genes are nonzero.</p></sec><sec id="s13"><title>Optimization Algorithm.</title><p>We optimize the object function in <xref ref-type="disp-formula" rid="eq1">Eq. <bold>1</bold></xref> by a multiplicative update algorithm,<disp-formula id="uneq1"><mml:math id="me4"><mml:mrow><mml:msubsup><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msubsup><mml:mo>&#x02190;</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msubsup><mml:mo>&#x02009;</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>O</mml:mi><mml:msubsup><mml:mi>H</mml:mi><mml:mn>1</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>&#x003bb;</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mn>2</mml:mn></mml:mfrac><mml:msup><mml:mi>A</mml:mi><mml:mi>T</mml:mi></mml:msup><mml:mrow><mml:mover accent="true"><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo stretchy="true">&#x0223c;</mml:mo></mml:mover></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:msub><mml:mi>H</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:msubsup><mml:mi>H</mml:mi><mml:mn>1</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:mi>&#x003bc;</mml:mi><mml:msub><mml:mi>W</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula><disp-formula id="uneq2"><mml:math id="me5"><mml:mrow><mml:msubsup><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>&#x02190;</mml:mo><mml:msubsup><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>&#x02009;</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:msubsup><mml:mi>H</mml:mi><mml:mn>2</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>&#x003bb;</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:msub><mml:mi>&#x003bb;</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mfrac><mml:mi>A</mml:mi><mml:msub><mml:mi>W</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:msub><mml:mi>H</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:msubsup><mml:mi>H</mml:mi><mml:mn>2</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:mi>&#x003bc;</mml:mi><mml:msub><mml:mi>W</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula><disp-formula id="uneq3"><mml:math id="me6"><mml:mrow><mml:msubsup><mml:mi>h</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msubsup><mml:mo>&#x02190;</mml:mo><mml:msubsup><mml:mi>h</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msubsup><mml:mo>&#x02009;</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>W</mml:mi><mml:mn>1</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:mi>O</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>W</mml:mi><mml:mn>1</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:msub><mml:mi>W</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:msub><mml:mi>H</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></disp-formula><disp-formula id="uneq4"><mml:math id="me7"><mml:mrow><mml:msubsup><mml:mi>h</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>&#x02190;</mml:mo><mml:msubsup><mml:mi>h</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mo>&#x02009;</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>W</mml:mi><mml:mn>2</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:mi>E</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mi>W</mml:mi><mml:mn>2</mml:mn><mml:mi>T</mml:mi></mml:msubsup><mml:msub><mml:mi>W</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:msub><mml:mi>H</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mrow></mml:math></disp-formula></p><p content-type="flushleft">where <inline-formula><mml:math id="i15"><mml:mrow><mml:msubsup><mml:mi>w</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:mi>j</mml:mi></mml:mrow><mml:mn>1</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> represents the element of the <italic>i</italic>th row and the <italic>j</italic>th column in matrix <inline-formula><mml:math id="i16"><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> and the same representation is used in <inline-formula><mml:math id="i17"><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula>
<inline-formula><mml:math id="i18"><mml:mrow><mml:msub><mml:mi>H</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="i19"><mml:mrow><mml:msub><mml:mi>H</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>.</mml:mo></mml:mrow></mml:math></inline-formula> We stop the iteration when the relative error is less than 0.0001.</p></sec><sec id="s14"><title>Cluster-Specific Features.</title><p>We apply a <italic>t</italic> test to define the cluster-specific genes and cluster-specific peaks, and the default <italic>P</italic>-value cutoff is 0.0001.</p></sec><sec id="s15"><title>Evaluation of the Clustering Results.</title><p>We evaluate the results in terms of consistency of true expression values and the predicted values. We calculated the <inline-formula><mml:math id="i20"><mml:mrow><mml:mi>K</mml:mi><mml:mo>&#x000d7;</mml:mo><mml:mi>K</mml:mi></mml:mrow></mml:math></inline-formula> correlation matrix of <italic>AW</italic><sub>1</sub> with <inline-formula><mml:math id="i21"><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> which is denoted by <italic>R</italic>. We use the determinant of correlation matrix <italic>R</italic> to measure the consistency of true expression values with the predicted values. Higher determinant means higher diagonal of the matrix, which means higher correlation between matched clusters and lower correlation between unmatched clusters. When <italic>K</italic> = 1, the determinant simply reflects the correlation between true gene expression and predicted gene expression. When <italic>K</italic> &#x0003e; 1, the determinant will integrate information from both within-cluster correlations and between-cluster correlations. For example, suppose there are three true clusters in the population but in our clustering result one of the true clusters is randomly split into two subclusters. In this situation, the clustering result has four clusters and all four within-cluster correlations will be high; however, the determinant will be close to zero because the correlation vectors due to the two subclusters will be highly colinear. Thus, the use of the determinant instead of the product of within-cluster correlations will offer protection against overpartitioning.</p></sec><sec id="s16"><title>Parameter Selection.</title><p>We solve optimization problems <inline-formula><mml:math id="i22"><mml:mrow><mml:munder><mml:mrow><mml:mtext>min</mml:mtext></mml:mrow><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>&#x02009;</mml:mo><mml:msub><mml:mi>H</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>&#x02265;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:munder><mml:msubsup><mml:mrow><mml:mrow><mml:mo>&#x02016;</mml:mo><mml:mrow><mml:mi>O</mml:mi><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:msub><mml:mi>H</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow><mml:mo>&#x02016;</mml:mo></mml:mrow></mml:mrow><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula>
<inline-formula><mml:math id="i23"><mml:mrow><mml:munder><mml:mrow><mml:mtext>min</mml:mtext></mml:mrow><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>,</mml:mo><mml:mo>&#x02009;</mml:mo><mml:msub><mml:mi>H</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mo>&#x02265;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:munder><mml:msubsup><mml:mrow><mml:mrow><mml:mo>&#x02016;</mml:mo><mml:mrow><mml:mi>E</mml:mi><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:msub><mml:mi>H</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow><mml:mo>&#x02016;</mml:mo></mml:mrow></mml:mrow><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></inline-formula> by the alternating least-squares (ALS) algorithm with 50 different initializations using a Monte Carlo-type approach (<xref rid="r21" ref-type="bibr">21</xref>) and get the solutions <inline-formula><mml:math id="i24"><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>&#x02009;</mml:mo><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mn>20</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>&#x02009;</mml:mo><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mn>20</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> which are used as initial solutions in our optimization problem. We choose parameter <inline-formula><mml:math id="i25"><mml:mrow><mml:mi>&#x003bc;</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:msubsup><mml:mrow><mml:mrow><mml:mo>&#x02016;</mml:mo><mml:mrow><mml:mi>O</mml:mi><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub><mml:msub><mml:mi>H</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>&#x02016;</mml:mo></mml:mrow></mml:mrow><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mrow><mml:mo>&#x02016;</mml:mo><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mn>10</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>&#x02016;</mml:mo></mml:mrow></mml:mrow><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mrow><mml:mo>&#x02016;</mml:mo><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mn>20</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>&#x02016;</mml:mo></mml:mrow></mml:mrow><mml:mi>F</mml:mi><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></inline-formula> Tuning parameters <inline-formula><mml:math id="i26"><mml:mrow><mml:msub><mml:mi>&#x003bb;</mml:mi><mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="i27"><mml:mrow><mml:msub><mml:mi>&#x003bb;</mml:mi><mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:math></inline-formula> are chosen from 0.001, 0.01, 0.1, 1, 10, 100, 1,000, and 10,000. The determinant of correlation matrix <italic>R</italic> can be used to select the tuning parameters. We choose the tuning parameters which give the highest determinant (<ext-link ext-link-type="uri" xlink:href="http://www.pnas.org/lookup/suppl/doi:10.1073/pnas.1805681115/-/DCSupplemental" xlink:show="new"><italic>SI Appendix</italic>, Fig. S9</ext-link>). The number of clusters <italic>K</italic> can be determined by a method similar to that in ref. <xref rid="r13" ref-type="bibr">13</xref>.</p></sec><sec id="s17"><title>TF Motif Activity.</title><p>We use the software chromVAR (<xref rid="r22" ref-type="bibr">22</xref>) to calculate the TF motif activity on each single cell based on its scATAC-seq data.</p></sec><sec id="s18"><title>Single-Cell Sample at RA Day 4.</title><p>We generated a heterogeneous biological population of cells that arise from the same origin. Specifically, we used the hanging-drop technique to form embryonic bodies (EBs) from mouse embryonic stem cells (mESCs) and induced differentiation by RA treatment. After 4 d of induction, we sample cells for bulk RNA-seq and bulk ATACC-seq experiments for use in validating the coupling. To test the coupled-NMF clustering method, we also generated scATAC-seq and scRNA-seq on the RA day-4 population. After removing low read-count cells (3,000 in RNA-seq and 10,000 in ATAC-seq), we get ATAC-seq data and RNA-seq data on 415 and 463 single cells, respectively.</p></sec><sec id="s19"><title>Data Processing.</title><p>We align the scATAC-seq reads to reference genome mm9 and remove duplicates. We employed MACS2 (<xref rid="r23" ref-type="bibr">23</xref>) to do peak calling by merging all of the reads from all of the single cells. We consider only the narrow peaks which are at least present (one or more reads) on 10 cells. Read counts for each region on each cell are calculated by bedtools (<xref rid="r24" ref-type="bibr">24</xref>) with the intersect command. Features defined from scATAC-seq data consist of an openness index on regions including REs and narrow peaks from MACS2. REs include promoters and enhancers. We use REs that regulate at least one TG from the PECA network (<xref rid="r7" ref-type="bibr">7</xref>).</p><p>scRNA-seq raw reads are mapped to mm10 by STAR (<xref rid="r25" ref-type="bibr">25</xref>) with ENCODE options. Gene expression TPM are calculated by RSEM (<xref rid="r26" ref-type="bibr">26</xref>). The transcriptome annotation we use is GENCODE vM16.</p></sec><sec id="s20"><title>Simulation of scRNA-Seq and scATAC-Seq.</title><p>We simulate scRNA-seq data for each single cell from bulk RNA-seq data by following the Splatter pipeline (<xref rid="r27" ref-type="bibr">27</xref>). Specifically, it includes three steps: (<italic>i</italic>) adding noise on expression data <italic>T</italic>, <inline-formula><mml:math id="i28"><mml:mrow><mml:mi>T</mml:mi><mml:mo>=</mml:mo><mml:mi>T</mml:mi><mml:mi>P</mml:mi><mml:mi>M</mml:mi><mml:mo>+</mml:mo><mml:mi>&#x003b5;</mml:mi><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> where <inline-formula><mml:math id="i29"><mml:mi>&#x003b5;</mml:mi></mml:math></inline-formula> is Gaussian noise with SNR = 5; (<italic>ii</italic>) getting expected read counts per gene <inline-formula><mml:math id="i30"><mml:mrow><mml:msub><mml:mi>&#x003bb;</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>N</mml:mi><mml:mrow><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>/</mml:mo><mml:mrow><mml:msub><mml:mstyle displaystyle="true"><mml:mo>&#x02211;</mml:mo></mml:mstyle><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mrow><mml:mi>P</mml:mi><mml:mo>&#x000d7;</mml:mo><mml:mn>0.5</mml:mn><mml:mo>%</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> where <italic>N</italic> is the total number of read counts in bulk data, <inline-formula><mml:math id="i31"><mml:mrow><mml:msub><mml:mi>L</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> and <inline-formula><mml:math id="i32"><mml:mrow><mml:msub><mml:mi>T</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></inline-formula> are gene length and its expression for gene <italic>i</italic>, and <italic>P</italic> reflects the sequencing depth for each single cell <inline-formula><mml:math id="i33"><mml:mrow><mml:mi>P</mml:mi><mml:mo>&#x0223c;</mml:mo><mml:mi>B</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi><mml:mi>a</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mn>2,4</mml:mn><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></inline-formula>; and (<italic>iii</italic>) getting the observed read counts for each gene, <inline-formula><mml:math id="i34"><mml:mrow><mml:msub><mml:mi>Y</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> where read count <inline-formula><mml:math id="i35"><mml:mrow><mml:msub><mml:mi>X</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>&#x0223c;</mml:mo><mml:mi>P</mml:mi><mml:mi>o</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>&#x003bb;</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>,</mml:mo></mml:mrow></mml:math></inline-formula> and dropout effect <inline-formula><mml:math id="i36"><mml:mrow><mml:msub><mml:mi>D</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>&#x0223c;</mml:mo><mml:mi>B</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:msubsup><mml:mi>&#x003bb;</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mn>0.1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:math></inline-formula> In scATAC-seq simulation, we use the same procedure by replacing the TPM as openness (defined as number of read counts per 1,000 bp per 100 million mapped reads). The distribution of read counts in our simulation data is similar to the distribution of reads counts in 10&#x000d7; genomics scRNA-seq data and C1 Fluidigm scATAC-seq data.</p></sec><sec id="s21"><title>Experimental Design of RA-Induced mESC Differentiation.</title><p>mESC lines R1 were obtained from ATCC. The mESCs were first expanded on a mouse embryonic fibroblasts feeder layer previously irradiated. Then, subculturing was carried out on 0.1% bovine gelatin-coated tissue culture plates. Cells were propagated in mESC medium consisting of Knockout DMEM supplemented with 15% Knockout Serum Replacement, 100 <inline-formula><mml:math id="i37"><mml:mrow><mml:mi mathvariant="normal">&#x003bc;</mml:mi><mml:mtext>M</mml:mtext></mml:mrow></mml:math></inline-formula> nonessential amino acids, 0.5 mM beta-mercaptoethanol, 2 mM GlutaMax, and 100 units/mL penicillin&#x02013;streptomycin with the addition of 1,000 units/mL leukemia inhibitory factor (ESGRO; Millipore).</p><p>mESCs were differentiated using the hanging-drop method (<xref rid="r28" ref-type="bibr">28</xref>). Trypsinized cells were suspended in differentiation medium (mESC medium without LIF) to a concentration of 50,000 cells/mL. Twenty-microliter drops (&#x0223c;1,000 cells) were then placed on the lid of a bacterial plate and the lid was placed upside down. After 48 h incubation, EBs formed at the bottom of the drops were collected and placed in the well of a six-well ultralow attachment plate with fresh differentiation medium containing 0.5 &#x003bc;M RA for up to 4 d, with the medium being changed daily.</p></sec><sec id="s22"><title>scATAC-Seq.</title><p>We followed the scATAC-seq protocol published by Buenrostro et al. (<xref rid="r2" ref-type="bibr">2</xref>) with the following modifications. The EBs were first incubated with StemPro Accutase cell dissociation reagent (Gibco) at 37 &#x000b0;C for 10 min, and then the EBs were gently pipetted for an additional 15 min to obtain a single-cell suspension. To further remove nondissociated EBs, the cell suspension was filtered sequentially with a 40-&#x003bc;M cell strainer (BD Falcon) and a 20-&#x003bc;M pluriStrainer (pluriSelect). After washing three times with C1 DNA Seq Cell Wash Buffer, cells at a concentration of 350&#x02013;400 cells/&#x003bc;L were loaded on the C1 Single-Cell Auto Prep System (Fluidigm, Inc.). Single cells were captured and processed on a 10- to 17-&#x003bc;M IFC microfluidic chip using ATAC-seq scripts (<xref rid="r2" ref-type="bibr">2</xref>). A total of seven IFC chips were included in this study. The library was sequenced on Illumina NextSeq with 75-bp paired-end reads.</p></sec><sec id="s23"><title>scRNA-Seq.</title><p>To prepare a scRNA-seq library, we followed the SMART-Seq v4 Ultra Low Input RNA Kit for the Fluidigm C1 System (Clontech Laboratories, Inc.). The EBs were first dissociated with Accutase as described previously. Cells at a concentration of 200&#x02013;250 cells/&#x003bc;L were then loaded on the C1 Single-Cell Auto Prep System (Fluidigm, Inc.). The single cells were captured and processed on a 10- to 17-&#x003bc;M IFC microfluidic chip, using SMART-Seq v4 scripts. A total of five IFC chips were included in this study. After harvest, cDNA concentration for each sample was measured using the Fragment Analyzer Automated CE System (Advanced Analytical Technologies, Inc.) and the cDNA concentration we used for Nextera XT library preparation is &#x0223c;0.2 ng/&#x003bc;L. The library was sequenced on Illumina HiSeq with 100-bp paired-end reads.</p></sec><sec id="s24"><title>Software and Data.</title><p>Software and simulation data are available at <ext-link ext-link-type="uri" xlink:href="http://web.stanford.edu/~zduren/CoupledNMF/" xlink:show="new">http://web.stanford.edu/&#x0223c;zduren/CoupledNMF/</ext-link>. Single-cell gene expression data and chromatin accessibility data of RA induction have been deposited in the GEO database under accession nos. GSE115968 and GSE115970.</p></sec></sec><sec sec-type="supplementary-material"><title>Supplementary Material</title><supplementary-material content-type="local-data"><label>Supplementary File</label><media xlink:href="pnas.1805681115.sapp.pdf"/></supplementary-material><supplementary-material content-type="local-data"><label>Supplementary File</label><media xlink:href="pnas.1805681115.sd01.xlsx"/></supplementary-material></sec></body><back><ack><p>This work was supported by National Institutes of Health Grants R01HG007834, R01GM109836, and P50HG007735 and the Strategic Priority Research Program of the Chinese Academy of Sciences (XDB13000000).</p></ack><fn-group><fn fn-type="COI-statement"><p>The authors declare no conflict of interest.</p></fn><fn fn-type="other"><p>Data deposition: The single- cell gene expression data and chromatin accessibility data of RA induction reported in this paper have been deposited in the Gene Expression Omnibus (GEO) database, <ext-link ext-link-type="uri" xlink:href="https://www.ncbi.nlm.nih.gov/geo" xlink:show="new">https://www.ncbi.nlm.nih.gov/geo</ext-link> (accession nos. <ext-link ext-link-type="NCBI:geo" xlink:href="GSE115968" xlink:show="new">GSE115968</ext-link> and <ext-link ext-link-type="NCBI:geo" xlink:href="GSE115970" xlink:show="new">GSE115970</ext-link>).</p></fn><fn fn-type="supplementary-material"><p>This article contains supporting information online at <ext-link ext-link-type="uri" xlink:href="http://www.pnas.org/lookup/suppl/doi:10.1073/pnas.1805681115/-/DCSupplemental" xlink:show="new">www.pnas.org/lookup/suppl/doi:10.1073/pnas.1805681115/-/DCSupplemental</ext-link>.</p></fn></fn-group><ref-list><ref id="r1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Tang</surname><given-names>F</given-names></name><etal/></person-group><year>2009</year><article-title>mRNA-seq whole-transcriptome analysis of a single cell</article-title><source>Nat Methods</source><volume>6</volume><fpage>377</fpage><lpage>382</lpage><pub-id pub-id-type="pmid">19349980</pub-id></element-citation></ref><ref id="r2"><label>2</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Buenrostro</surname><given-names>JD</given-names></name><etal/></person-group><year>2015</year><article-title>Single-cell chromatin accessibility reveals principles of regulatory variation</article-title><source>Nature</source><volume>523</volume><fpage>486</fpage><lpage>490</lpage><pub-id pub-id-type="pmid">26083756</pub-id></element-citation></ref><ref id="r3"><label>3</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Smallwood</surname><given-names>SA</given-names></name><etal/></person-group><year>2014</year><article-title>Single-cell genome-wide bisulfite sequencing for assessing epigenetic heterogeneity</article-title><source>Nat Methods</source><volume>11</volume><fpage>817</fpage><lpage>820</lpage><pub-id pub-id-type="pmid">25042786</pub-id></element-citation></ref><ref id="r4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Kiselev</surname><given-names>VY</given-names></name><etal/></person-group><year>2017</year><article-title>SC3: Consensus clustering of single-cell RNA-seq data</article-title><source>Nat Methods</source><volume>14</volume><fpage>483</fpage><lpage>486</lpage><pub-id pub-id-type="pmid">28346451</pub-id></element-citation></ref><ref id="r5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Habib</surname><given-names>N</given-names></name><etal/></person-group><year>2017</year><article-title>Massively parallel single-nucleus RNA-seq with DroNc-seq</article-title><source>Nat Methods</source><volume>14</volume><fpage>955</fpage><lpage>958</lpage><pub-id pub-id-type="pmid">28846088</pub-id></element-citation></ref><ref id="r6"><label>6</label><element-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Zamanighomi</surname><given-names>M</given-names></name><etal/></person-group><year>2017</year><comment>Unsupervised clustering and epigenetic classification of single cells. bioRxiv:10.1101/143701. Preprint, posted December 4, 2017</comment></element-citation></ref><ref id="r7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Duren</surname><given-names>Z</given-names></name><name name-style="western"><surname>Chen</surname><given-names>X</given-names></name><name name-style="western"><surname>Jiang</surname><given-names>R</given-names></name><name name-style="western"><surname>Wang</surname><given-names>Y</given-names></name><name name-style="western"><surname>Wong</surname><given-names>WH</given-names></name></person-group><year>2017</year><article-title>Modeling gene regulation from paired expression and chromatin accessibility data</article-title><source>Proc Natl Acad Sci USA</source><volume>114</volume><fpage>E4914</fpage><lpage>E4923</lpage><pub-id pub-id-type="pmid">28576882</pub-id></element-citation></ref><ref id="r8"><label>8</label><element-citation publication-type="journal"><person-group person-group-type="author"><collab>ENCODE Project Consortium</collab></person-group><year>2012</year><article-title>An integrated encyclopedia of DNA elements in the human genome</article-title><source>Nature</source><volume>489</volume><fpage>57</fpage><lpage>74</lpage><pub-id pub-id-type="pmid">22955616</pub-id></element-citation></ref><ref id="r9"><label>9</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Corces</surname><given-names>MR</given-names></name><etal/></person-group><year>2016</year><article-title>Lineage-specific and single-cell chromatin accessibility charts human hematopoiesis and leukemia evolution</article-title><source>Nat Genet</source><volume>48</volume><fpage>1193</fpage><lpage>1203</lpage><pub-id pub-id-type="pmid">27526324</pub-id></element-citation></ref><ref id="r10"><label>10</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lake</surname><given-names>BB</given-names></name><etal/></person-group><year>2018</year><article-title>Integrative single-cell analysis of transcriptional and epigenetic states in the human adult brain</article-title><source>Nat Biotechnol</source><volume>36</volume><fpage>70</fpage><lpage>80</lpage><pub-id pub-id-type="pmid">29227469</pub-id></element-citation></ref><ref id="r11"><label>11</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Bacher</surname><given-names>R</given-names></name><name name-style="western"><surname>Kendziorski</surname><given-names>C</given-names></name></person-group><year>2016</year><article-title>Design and computational analysis of single-cell RNA-sequencing experiments</article-title><source>Genome Biol</source><volume>17</volume><fpage>63</fpage><pub-id pub-id-type="pmid">27052890</pub-id></element-citation></ref><ref id="r12"><label>12</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lara-Astiaso</surname><given-names>D</given-names></name><etal/></person-group><year>2014</year><article-title>Immunogenetics. Chromatin state dynamics during blood formation</article-title><source>Science</source><volume>345</volume><fpage>943</fpage><lpage>949</lpage><pub-id pub-id-type="pmid">25103404</pub-id></element-citation></ref><ref id="r13"><label>13</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Brunet</surname><given-names>J-P</given-names></name><name name-style="western"><surname>Tamayo</surname><given-names>P</given-names></name><name name-style="western"><surname>Golub</surname><given-names>TR</given-names></name><name name-style="western"><surname>Mesirov</surname><given-names>JP</given-names></name></person-group><year>2004</year><article-title>Metagenes and molecular pattern discovery using matrix factorization</article-title><source>Proc Natl Acad Sci USA</source><volume>101</volume><fpage>4164</fpage><lpage>4169</lpage><pub-id pub-id-type="pmid">15016911</pub-id></element-citation></ref><ref id="r14"><label>14</label><element-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Gorkin</surname><given-names>D</given-names></name><etal/></person-group><year>2017</year><comment>Systematic mapping of chromatin state landscapes during mouse development. bioRxiv:10.1101/166652. Preprint, posted August 3, 2017</comment></element-citation></ref><ref id="r15"><label>15</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Lin</surname><given-names>S-C</given-names></name><etal/></person-group><year>2010</year><article-title>Endogenous retinoic acid regulates cardiac progenitor differentiation</article-title><source>Proc Natl Acad Sci USA</source><volume>107</volume><fpage>9234</fpage><lpage>9239</lpage><pub-id pub-id-type="pmid">20439714</pub-id></element-citation></ref><ref id="r16"><label>16</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Maden</surname><given-names>M</given-names></name><name name-style="western"><surname>Holder</surname><given-names>N</given-names></name></person-group><year>1992</year><article-title>Retinoic acid and development of the central nervous system</article-title><source>BioEssays</source><volume>14</volume><fpage>431</fpage><lpage>438</lpage><pub-id pub-id-type="pmid">1359884</pub-id></element-citation></ref><ref id="r17"><label>17</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Hartigan</surname><given-names>JA</given-names></name></person-group><year>1972</year><article-title>Direct clustering of a data matrix</article-title><source>J Am Stat Assoc</source><volume>67</volume><fpage>123</fpage><lpage>129</lpage></element-citation></ref><ref id="r18"><label>18</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Cheng</surname><given-names>Y</given-names></name><name name-style="western"><surname>Church</surname><given-names>GM</given-names></name></person-group><year>2000</year><article-title>Biclustering of expression data</article-title><source>Proc Int Conf Intell Syst Mol Biol</source><volume>8</volume><fpage>93</fpage><lpage>103</lpage><pub-id pub-id-type="pmid">10977070</pub-id></element-citation></ref><ref id="r19"><label>19</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Zhang</surname><given-names>S</given-names></name><name name-style="western"><surname>Li</surname><given-names>Q</given-names></name><name name-style="western"><surname>Liu</surname><given-names>J</given-names></name><name name-style="western"><surname>Zhou</surname><given-names>XJ</given-names></name></person-group><year>2011</year><article-title>A novel computational framework for simultaneous integration of multiple types of genomic data to identify microRNA-gene regulatory modules</article-title><source>Bioinformatics</source><volume>27</volume><fpage>i401</fpage><lpage>i409</lpage><pub-id pub-id-type="pmid">21685098</pub-id></element-citation></ref><ref id="r20"><label>20</label><element-citation publication-type="other"><person-group person-group-type="author"><name name-style="western"><surname>Bickel</surname><given-names>S</given-names></name><name name-style="western"><surname>Scheffer</surname><given-names>T</given-names></name></person-group><year>2004</year><comment>Multi-view clustering. <italic>Proceedings of the IEEE International Conference on Data Mining (ICDM)</italic>, pp 19&#x02013;26</comment></element-citation></ref><ref id="r21"><label>21</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Berry</surname><given-names>MW</given-names></name><name name-style="western"><surname>Browne</surname><given-names>M</given-names></name><name name-style="western"><surname>Langville</surname><given-names>AN</given-names></name><name name-style="western"><surname>Pauca</surname><given-names>VP</given-names></name><name name-style="western"><surname>Plemmons</surname><given-names>RJ</given-names></name></person-group><year>2007</year><article-title>Algorithms and applications for approximate nonnegative matrix factorization</article-title><source>Comput Stat Data Anal</source><volume>52</volume><fpage>155</fpage><lpage>173</lpage></element-citation></ref><ref id="r22"><label>22</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Schep</surname><given-names>AN</given-names></name><name name-style="western"><surname>Wu</surname><given-names>B</given-names></name><name name-style="western"><surname>Buenrostro</surname><given-names>JD</given-names></name><name name-style="western"><surname>Greenleaf</surname><given-names>WJ</given-names></name></person-group><year>2017</year><article-title>chromVAR: Inferring transcription-factor-associated accessibility from single-cell epigenomic data</article-title><source>Nat Methods</source><volume>14</volume><fpage>975</fpage><lpage>978</lpage><pub-id pub-id-type="pmid">28825706</pub-id></element-citation></ref><ref id="r23"><label>23</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Zhang</surname><given-names>Y</given-names></name><etal/></person-group><year>2008</year><article-title>Model-based analysis of ChIP-seq (MACS)</article-title><source>Genome Biol</source><volume>9</volume><fpage>R137</fpage><pub-id pub-id-type="pmid">18798982</pub-id></element-citation></ref><ref id="r24"><label>24</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Quinlan</surname><given-names>AR</given-names></name><name name-style="western"><surname>Hall</surname><given-names>IM</given-names></name></person-group><year>2010</year><article-title>BEDTools: A flexible suite of utilities for comparing genomic features</article-title><source>Bioinformatics</source><volume>26</volume><fpage>841</fpage><lpage>842</lpage><pub-id pub-id-type="pmid">20110278</pub-id></element-citation></ref><ref id="r25"><label>25</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Dobin</surname><given-names>A</given-names></name><etal/></person-group><year>2013</year><article-title>Star: Ultrafast universal RNA-seq aligner</article-title><source>Bioinformatics</source><volume>29</volume><fpage>15</fpage><lpage>21</lpage><pub-id pub-id-type="pmid">23104886</pub-id></element-citation></ref><ref id="r26"><label>26</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Li</surname><given-names>B</given-names></name><name name-style="western"><surname>Dewey</surname><given-names>CN</given-names></name></person-group><year>2011</year><article-title>RSEM: Accurate transcript quantification from RNA-seq data with or without a reference genome</article-title><source>BMC Bioinformatics</source><volume>12</volume><fpage>323</fpage><pub-id pub-id-type="pmid">21816040</pub-id></element-citation></ref><ref id="r27"><label>27</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Zappia</surname><given-names>L</given-names></name><name name-style="western"><surname>Phipson</surname><given-names>B</given-names></name><name name-style="western"><surname>Oshlack</surname><given-names>A</given-names></name></person-group><year>2017</year><article-title>Splatter: Simulation of single-cell RNA sequencing data</article-title><source>Genome Biol</source><volume>18</volume><fpage>174</fpage><pub-id pub-id-type="pmid">28899397</pub-id></element-citation></ref><ref id="r28"><label>28</label><element-citation publication-type="journal"><person-group person-group-type="author"><name name-style="western"><surname>Wang</surname><given-names>X</given-names></name><name name-style="western"><surname>Yang</surname><given-names>P</given-names></name></person-group><year>2008</year><article-title>In vitro differentiation of mouse embryonic stem (mES) cells using the hanging drop method</article-title><source>J Vis Exp</source><volume>17</volume><fpage>825, 10.3791/825</fpage></element-citation></ref></ref-list></back></article>