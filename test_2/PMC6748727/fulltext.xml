<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.2 20190208//EN" "JATS-archivearticle1-mathml3.dtd"> 
<article xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:mml="http://www.w3.org/1998/Math/MathML" article-type="research-article"><?properties open_access?><?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?><?DTDIdentifier.IdentifierType public?><?SourceDTD.DTDName JATS-journalpublishing1.dtd?><?SourceDTD.Version 1.1?><?ConverterInfo.XSLTName jp2nlmx2.xsl?><?ConverterInfo.Version 1?><front><journal-meta><journal-id journal-id-type="nlm-ta">Bioinformatics</journal-id><journal-id journal-id-type="iso-abbrev">Bioinformatics</journal-id><journal-id journal-id-type="publisher-id">bioinformatics</journal-id><journal-title-group><journal-title>Bioinformatics</journal-title></journal-title-group><issn pub-type="ppub">1367-4803</issn><issn pub-type="epub">1367-4811</issn><publisher><publisher-name>Oxford University Press</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="pmcid">6748727</article-id><article-id pub-id-type="doi">10.1093/bioinformatics/btz064</article-id><article-id pub-id-type="publisher-id">btz064</article-id><article-categories><subj-group subj-group-type="heading"><subject>Original Papers</subject><subj-group subj-group-type="category-toc-heading"><subject>Genome Analysis</subject></subj-group></subj-group></article-categories><title-group><article-title>Variational infinite heterogeneous mixture model for semi-supervised clustering of heart enhancers</article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Mehdi</surname><given-names>Tahmid F</given-names></name><xref ref-type="aff" rid="btz064-aff1">1</xref></contrib><contrib contrib-type="author"><name><surname>Singh</surname><given-names>Gurdeep</given-names></name><xref ref-type="aff" rid="btz064-aff2">2</xref></contrib><contrib contrib-type="author"><name><surname>Mitchell</surname><given-names>Jennifer A</given-names></name><xref ref-type="aff" rid="btz064-aff2">2</xref><xref ref-type="aff" rid="btz064-aff3">3</xref></contrib><contrib contrib-type="author"><name><surname>Moses</surname><given-names>Alan M</given-names></name><xref ref-type="aff" rid="btz064-aff1">1</xref><xref ref-type="aff" rid="btz064-aff2">2</xref><xref ref-type="aff" rid="btz064-aff3">3</xref><xref ref-type="corresp" rid="btz064-cor1"/><!--<email>alan.moses@utoronto.ca</email>--></contrib></contrib-group><aff id="btz064-aff1"><label>1</label>
<institution>Department of Computer Science, University of Toronto</institution>, Toronto, ON, Canada</aff><aff id="btz064-aff2"><label>2</label>
<institution>Department of Cell &#x00026; Systems Biology, University of Toronto</institution>, Toronto, ON, Canada</aff><aff id="btz064-aff3"><label>3</label>
<institution>Centre for the Analysis of Genome Evolution and Function, University of Toronto</institution>, Toronto, ON, Canada</aff><contrib-group><contrib contrib-type="editor"><name><surname>Hancock</surname><given-names>John</given-names></name><role>Associate Editor</role></contrib></contrib-group><author-notes><corresp id="btz064-cor1">To whom correspondence should be addressed. E-mail: <email>alan.moses@utoronto.ca</email></corresp></author-notes><pub-date pub-type="ppub"><day>15</day><month>9</month><year>2019</year></pub-date><pub-date pub-type="epub" iso-8601-date="2019-02-07"><day>07</day><month>2</month><year>2019</year></pub-date><pub-date pub-type="pmc-release"><day>07</day><month>2</month><year>2019</year></pub-date><!-- PMC Release delay is 0 months and 0 days and was based on the <pub-date pub-type="epub"/>. --><volume>35</volume><issue>18</issue><fpage>3232</fpage><lpage>3239</lpage><history><date date-type="received"><day>12</day><month>10</month><year>2018</year></date><date date-type="rev-recd"><day>03</day><month>1</month><year>2019</year></date><date date-type="accepted"><day>06</day><month>2</month><year>2019</year></date></history><permissions><copyright-statement>&#x000a9; The Author(s) 2019. Published by Oxford University Press.</copyright-statement><copyright-year>2019</copyright-year><license license-type="cc-by-nc" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/"><license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution Non-Commercial License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by-nc/4.0/">http://creativecommons.org/licenses/by-nc/4.0/</ext-link>), which permits non-commercial re-use, distribution, and reproduction in any medium, provided the original work is properly cited. For commercial re-use, please contact journals.permissions@oup.com</license-p></license></permissions><self-uri xlink:href="btz064.pdf"/><abstract><title>Abstract</title><sec id="s1"><title>Motivation</title><p>Mammalian genomes can contain thousands of enhancers but only a subset are actively driving gene expression in a given cellular context. Integrated genomic datasets can be harnessed to predict active enhancers. One challenge in integration of large genomic datasets is the increasing heterogeneity: continuous, binary and discrete features may all be relevant. Coupled with the typically small numbers of training examples, semi-supervised approaches for heterogeneous data are needed; however, current enhancer prediction methods are not designed to handle heterogeneous data in the semi-supervised paradigm.</p></sec><sec id="s2"><title>Results</title><p>We implemented a Dirichlet Process Heterogeneous Mixture model that infers Gaussian, Bernoulli and Poisson distributions over features. We derived a novel variational inference algorithm to handle semi-supervised learning tasks where certain observations are forced to cluster together. We applied this model to enhancer candidates in mouse heart tissues based on heterogeneous features. We constrained a small number of known active enhancers to appear in the same cluster, and 47 additional regions clustered with them. Many of these are located near heart-specific genes. The model also predicted 1176 active promoters, suggesting that it can discover new enhancers and promoters.</p></sec><sec id="s3"><title>Availability and implementation</title><p>We created the &#x02018;dphmix&#x02019; Python package: <ext-link ext-link-type="uri" xlink:href="https://pypi.org/project/dphmix/">https://pypi.org/project/dphmix/</ext-link>.</p></sec><sec id="s4"><title>Supplementary information</title><p>
<xref ref-type="supplementary-material" rid="sup1">Supplementary data</xref> are available at <italic>Bioinformatics</italic> online.</p></sec></abstract><funding-group><award-group award-type="grant"><funding-source><named-content content-type="funder-name">Natural Sciences and Engineering Research Council of Canada</named-content><named-content content-type="funder-identifier">10.13039/501100000038</named-content></funding-source></award-group><award-group award-type="grant"><funding-source><named-content content-type="funder-name">NSERC</named-content><named-content content-type="funder-identifier">10.13039/501100000038</named-content></funding-source></award-group><award-group award-type="grant"><funding-source><named-content content-type="funder-name">Canada Foundation for Innovation</named-content><named-content content-type="funder-identifier">10.13039/501100000196</named-content></funding-source></award-group><award-group award-type="grant"><funding-source><named-content content-type="funder-name">Ontario Ministry of Research and Innovation</named-content></funding-source></award-group><award-group award-type="grant"><funding-source><named-content content-type="funder-name">Connaught International Scholarships</named-content></funding-source></award-group></funding-group><counts><page-count count="8"/></counts></article-meta></front><body><sec><title>1 Introduction</title><p>Enhancers are cis-regulatory elements in DNA that can influence expression levels of target genes when bound to transcription factors (TFs). They are thought to exist in at least three states of differing activity: active, primed and poised enhancers (<xref rid="btz064-B6" ref-type="bibr">Calo and Wysocka, 2013</xref>), such that only a subset of bound regions (active enhancers) play a role in gene regulation in a given cellular context. Although different states are distinguished by differential patterns of histone modifications and transcriptional regulator recruitment, systematically classifying the state of an enhancer remains a challenge (<xref rid="btz064-B8" ref-type="bibr">Catarino and Stark, 2018</xref>; <xref rid="btz064-B37" ref-type="bibr">Zentner <italic>et al.</italic>, 2011</xref>). Given an active enhancer, it is possible to predict tissues in which it is active (<xref rid="btz064-B21" ref-type="bibr">Li <italic>et al.</italic>, 2018</xref>; <xref rid="btz064-B27" ref-type="bibr">Pennacchio <italic>et al.</italic>, 2007</xref>). However, these methods do not address the problem of predicting the states of enhancers in a specific tissue.</p><p>Modern genomic data is highly heterogeneous and may contain continuous (e.g. histone modification levels), binary (e.g. TF-binding) and discrete features (e.g. counts of methylated sites) and, in principle, supervised machine learning methods can be used to identify active enhancers with integrated heterogeneous genomics data. Enhancer activity, however, is highly tissue-specific (<xref rid="btz064-B5" ref-type="bibr">Bulger and Groudine, 2011</xref>), and there are few tissues for which large numbers of active enhancers have been identified, limiting the application of recent supervised enhancer prediction approaches such as DECRES (<xref rid="btz064-B21" ref-type="bibr">Li <italic>et al.</italic>, 2018</xref>) and REPTILE (<xref rid="btz064-B14" ref-type="bibr">He <italic>et al.</italic>, 2017</xref>) to identify active enhancers in tissues of interest. Furthermore, these supervised methods have not been designed to predict enhancer states other than active and inactive enhancers.</p><p>Clustering (or unsupervised) techniques could, in principle, identify clusters of genomic regions that are enriched with different states of enhancers without large training sets. Unsupervised methods like ChromHMM (<xref rid="btz064-B11" ref-type="bibr">Ernst and Kellis, 2012</xref>) and Segway (<xref rid="btz064-B17" ref-type="bibr">Hoffman <italic>et al.</italic>, 2012</xref>) can predict enhancers; however, these methods were designed for genome segmentation rather than enhancer state prediction over enhancer candidates. Ideally, the small numbers of experimentally validated active enhancers should be used if possible: this motivates the development of semi-supervised approaches that can integrate heterogeneous data.</p><p>To integrate high-dimensional genomic data and predict enhancer states over enhancer candidates, we developed a variational Dirichlet Process Heterogeneous Mixture (DPHM or an infinite heterogeneous mixture) model that infers Gaussian, Bernoulli and Poisson distributions over continuous, binary and non-negative discrete features, respectively. To take advantage of small labeled training sets where available, we derive a novel variational inference algorithm for a semi-supervised DPHM model that forces a subset of the data (like experimentally validated enhancers) to cluster together. Our Bayesian model also has the advantages that i) the number of clusters, or enhancer states, is inferred from the data and ii) the number of hyperparameters does not grow with the number of clusters, simplifying inference for heterogeneous data integration. The DPHM model outperformed Gaussian mixture models in clustering synthetic heterogeneous datasets in unsupervised and semi-supervised settings. The DPHM model can also outperform k-means, in certain settings, even when k-means is given the correct number of clusters.</p><p>To illustrate the power of the DPHM model to integrate heterogeneous genomic data, we employed it to predict new enhancers based on heterogeneous features from the Encyclopedia of DNA Elements (ENCODE) Project (<xref rid="btz064-B10" ref-type="bibr">ENCODE Project Consortium, 2012</xref>). We applied the semi-supervised DPHM model to a dataset of 6209 genomic regions bound by Nkx2-5, a major regulator in heart development (<xref rid="btz064-B31" ref-type="bibr">Schott <italic>et al.</italic>, 1998</xref>; <xref rid="btz064-B33" ref-type="bibr">Tanaka <italic>et al.</italic>, 1999</xref>), in embryonic mouse heart with the constraint that a set of known active enhancers have to cluster together. Through our novel variational inference algorithm, 47 new regions clustered with the experimentally known active enhancers in this tissue. Furthermore, we discovered 5 large classes of genomic regions in the data. Some classes, including the class with the known active enhancers, were significantly (q&#x02009;&#x0003c;&#x02009;0.05) enriched with various biological processes. Another class, enriched for house-keeping genes, appears to contain active promoters. Moreover, each functional class of enhancers was enriched with at least 60 different TF-binding motifs and some motifs can be utilized to discriminate the classes from each other. Our analysis indicates that the semi-supervised DPHM model is a principled Bayesian method for discovering biologically relevant clusters in heterogeneous genomic data in the semi-supervised learning paradigm.</p></sec><sec><title>2 Materials and methods</title><sec><title>2.1 Data</title><p>
<xref rid="btz064-B9" ref-type="bibr">Dupays <italic>et al.</italic> (2015)</xref> identified genomic regions bound by Nkx2-5 using chromatin immunoprecipitation sequencing (ChIP-seq) data for embryonic mouse heart tissue. Genomic coordinates for the binding sites were converted from the GRCm37/mm9 to the GRCm38/mm10 genome build. To incorporate information about the functional conservation of the sites, we identified regions of the human genome (GRCh38/hg38 build) whose DNA sequences are alignable to the sites using LiftOver (<xref rid="btz064-B15" ref-type="bibr">Hinrichs <italic>et al.</italic>, 2006</xref>). We found that 6209/7246 of the binding sites in the mouse genome had human orthologs. 109 of the regions overlapped with experimentally validated developmental enhancers in mouse heart tissue, identified by the VISTA Enhancer Browser (<xref rid="btz064-B34" ref-type="bibr">Visel <italic>et al.</italic>, 2007</xref>). Features for the regions were generated from ENCODE datasets (<xref rid="btz064-B10" ref-type="bibr">ENCODE Project Consortium, 2012</xref>) for mouse and human heart tissues. <xref ref-type="supplementary-material" rid="sup1">Supplementary Table S1</xref> lists all of the datasets that we used to extract features. We extracted 81 mouse features and 33 human features. Details about feature extraction techniques are provided in the <xref ref-type="supplementary-material" rid="sup1">Supplementary Information</xref>.</p></sec><sec><title>2.2 Dirichlet process heterogeneous mixture models</title><p>The DPHM model takes observations with heterogeneous features and clusters them based on similarities between their features. Continuous, binary and non-negative discrete features are assumed to follow Gaussian, Bernoulli and Poisson distributions, respectively, and are assumed to be mutually independent so the conditional likelihood of an observation is the product of distributions, with cluster-specific parameters, for each feature. In this section, we assume the data has <italic>r<sub>g</sub>, r<sub>b</sub></italic> and <italic>r<sub>p</sub></italic> Gaussian, Bernoulli and Poisson features, respectively.</p><p>
<xref ref-type="fig" rid="btz064-F1">Figure&#x000a0;1</xref> shows the latent variables of the semi-supervised DPHM model. <italic>&#x003bc;</italic> and <italic>&#x003c4;</italic> contain the means and precisions of the Gaussian features, respectively, <italic>P</italic> contains the probability parameters for the Bernoulli features and <italic>&#x003bb;</italic> contains the average rate parameters for the Poisson features. The subscripts on the variables denote their feature indices and associated clusters. For example, <italic>&#x003bc;<sub>t</sub></italic><sub><italic>j</italic></sub> represents the mean parameter for the <italic>j</italic>th Gaussian feature and cluster <italic>t</italic>.
</p><fig id="btz064-F1" orientation="portrait" position="float"><label>Fig. 1.</label><caption><p>A Bayesian network depicting the dependencies between hyperparameters, latent variables and observations in the DPHM. Each observation, x<sub>i</sub>, depends on their cluster assignment (c<sub>i</sub> for observations that are not in any must-link constraints and c<sup>m</sup> for observations in a must-link constraint <italic>m</italic>) and distribution parameters (<italic>&#x003bc;, &#x003c4;, p</italic> and <italic>&#x003bb;</italic>). Distribution parameters depend on parameters of the NGBG prior (<italic>&#x003bd;, &#x003c1;, a, b, &#x003b3;, &#x003b4;, &#x003b5;</italic> and <italic>&#x003b6;</italic>). Distribution parameters and hyperparameters related to Gaussian, Bernoulli and Poisson features are top two rows, left center and right, respectively. Each cluster assignment depends on the v<sub>t</sub>s that are generated through the stick-breaking construction. <italic>M</italic> represents a set of must-link constraints for semi-supervised clustering</p></caption><graphic xlink:href="btz064f1"/></fig><sec><title>2.2.1 Priors</title><p>Distribution parameters (<italic>&#x003bc;, &#x003c4;, p</italic> and <italic>&#x003bb;</italic>) are drawn from their conjugate priors (<xref rid="btz064-B2" ref-type="bibr">Bishop, 2006</xref>). The conjugate priors for Gaussian, Bernoulli and Poisson distributions are NormalGamma (NG), Beta and Gamma distributions, respectively. Since features are assumed to be mutually independent, the joint conjugate prior for the distribution parameters can be expressed as:
<disp-formula id="E1"><label>(1)</label><mml:math id="M1"><mml:mi mathvariant="normal">&#x003bc;</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="normal">&#x003c4;</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="normal">&#x000a0;</mml:mi><mml:mi mathvariant="normal">p</mml:mi><mml:mo>,</mml:mo><mml:mi mathvariant="normal">&#x003bb;</mml:mi><mml:mi mathvariant="normal">&#x000a0;</mml:mi><mml:mo>&#x0223c;</mml:mo><mml:mrow><mml:munderover><mml:mo stretchy="false">&#x0220f;</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mrow><mml:mi mathvariant="normal">NG</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mo>&#x003bd;</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>&#x003c1;</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:munderover><mml:mo stretchy="false">&#x0220f;</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mrow><mml:mi mathvariant="normal">Beta</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mo>&#x003b3;</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>&#x003b4;</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mrow><mml:munderover><mml:mo stretchy="false">&#x0220f;</mml:mo><mml:mrow><mml:mi>l</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>r</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mrow><mml:mi mathvariant="normal">Gamma</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mo>&#x003b5;</mml:mo></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>&#x003b6;</mml:mo></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow></mml:mrow><mml:mi mathvariant="normal">&#x000a0;</mml:mi></mml:math></disp-formula>
where hyperparameters <italic>&#x003bd;<sub>j</sub>, &#x003c1;<sub>j</sub>, a<sub>j</sub></italic> and <italic>b<sub>j</sub></italic> control the prior mean, precision, shape and rate parameters, respectively, of the NG distribution that generates the mean and precision for the <italic>j</italic>th Gaussian feature. <italic>&#x003b3;<sub>k</sub></italic> and <italic>&#x003b4;<sub>k</sub></italic> represent the prior shape parameters of the Beta distribution that creates the probability parameter for the <italic>k</italic>th Bernoulli feature. <italic>&#x003b5;<sub>l</sub></italic> and <italic>&#x003b6;<sub>l</sub></italic> are the prior shape and rate parameters, respectively, for the Gamma distribution that generates the average rate parameter for the <italic>l</italic>th Poisson feature. The conjugate prior eases computations because the cluster-specific posterior distributions of <italic>&#x003bc;, &#x003c4;, p</italic> and <italic>&#x003bb;</italic> will be members of the conjugate prior&#x02019;s family; we refer to this family as &#x02019;NGBG&#x02019;.</p><p>Cluster assignments (denoted by <italic>c</italic>) for each observation are drawn from multinomial distributions, and their prior parameters are mixing weights for the clusters. Mixing weights are constructed through the truncated stick-breaking process (<xref rid="btz064-B19" ref-type="bibr">Ishwaran and James, 2001</xref>) that sets an upper bound, <italic>T</italic>, on the number of clusters. Mixing weights are completely determined by stick-breaking variables <inline-formula id="IE1"><mml:math id="IM1"><mml:msubsup><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>v</mml:mi></mml:mrow><mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:mrow><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msubsup></mml:math></inline-formula> that depend on <italic>&#x003b1;</italic>, a hyperparameter that controls cluster sizes. Although there are <italic>T</italic> clusters, some of them will be empty if <italic>T</italic> is large enough and can be ignored in downstream analyses. Cluster assignments, stick-breaking variables and distribution parameters form the latent variable space, while <italic>&#x003b1;</italic> and parameters of the NGBG prior form the hyperparameter space of the DPHM model.</p></sec><sec><title>2.2.2 Variational inference for semi-supervised DPHMs</title><p>We use variational inference (<xref rid="btz064-B1" ref-type="bibr">Beal, 2003</xref>; <xref rid="btz064-B3" ref-type="bibr">Blei and Jordan, 2006</xref>) to fit the DPHM model to a dataset <italic>X</italic>. Variational inference approximates the true posterior of the latent variables with a variational distribution <italic>q</italic> by maximizing the evidence lower bound (ELBO):
<disp-formula id="E2"><label>(2)</label><mml:math id="M2"><mml:mi mathvariant="normal">ELBO</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi mathvariant="normal">q</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:mi mathvariant="double-struck">E</mml:mi><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mrow><mml:mrow><mml:mi mathvariant="normal">ln</mml:mi></mml:mrow><mml:mo>&#x02061;</mml:mo><mml:mo>&#x000a0;</mml:mo><mml:mrow><mml:mi>P</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mi>X</mml:mi><mml:mo>,</mml:mo><mml:mo>&#x003bc;</mml:mo><mml:mo>,</mml:mo><mml:mo>&#x003c4;</mml:mo><mml:mo>,</mml:mo><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mo>&#x003bb;</mml:mo><mml:mo>,</mml:mo><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mrow></mml:mrow></mml:mfenced><mml:mo>-</mml:mo><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo>[</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="normal">ln</mml:mi></mml:mrow><mml:mo>&#x02061;</mml:mo><mml:mo>&#x000a0;</mml:mo><mml:mrow><mml:mi>q</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:mo>&#x003bc;</mml:mo><mml:mo>,</mml:mo><mml:mo>&#x003c4;</mml:mo><mml:mo>,</mml:mo><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mo>&#x003bb;</mml:mo><mml:mo>,</mml:mo><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mrow><mml:mo>]</mml:mo><mml:mi mathvariant="normal">&#x000a0;</mml:mi></mml:math></disp-formula></p><p>We optimize over the mean-field variational family so <italic>q</italic> factorizes into the product of variational densities for the latent variables. The variational density for a cluster assignment is parameterized by a &#x02019;cluster probability vector&#x02019; that contains probabilities of the corresponding observation belonging to the different clusters; each observation is assigned the cluster associated with the maximum probability in its cluster probability vector. We use &#x003c6;<sub><italic>i</italic></sub> to denote the cluster probability vector of the <italic>i</italic>th observation. The learning task of variational inference is to find variational densities that maximize the ELBO; this can be accomplished through coordinate ascent variational inference (<xref rid="btz064-B2" ref-type="bibr">Bishop, 2006</xref>). <xref rid="btz064-B22" ref-type="bibr">Lim and Wang (2018)</xref> derive variational density updates for latent variables of the Dirichlet Process Gaussian Mixture (DPGM) as shown in lines 4, 5 and 8 of Algorithm 1. We use these updates for the variational densities of &#x003bc;, &#x003c4;, c and v in our DPHM model but we must update Bernoulli and Poisson parameters as well. We derived the coordinate-optimal updates for <italic>q(p<sub>tk</sub>)</italic> and <italic>q(&#x003bb;<sub>tl</sub>)</italic> which represent the variational densities of the Bernoulli and Poisson parameters, respectively:
<disp-formula id="E3"><label>(3)</label><mml:math id="M3"><mml:mi>q</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tk</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>&#x0221d;</mml:mo><mml:mi mathvariant="italic">Beta</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tk</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003b3;</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:munder><mml:mo stretchy="false">&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003c6;</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">it</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">ik</mml:mi></mml:mrow><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>&#x003b4;</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:munder><mml:mo stretchy="false">&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003c6;</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">it</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">ik</mml:mi></mml:mrow><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mfenced><mml:mi mathvariant="normal">&#x000a0;</mml:mi></mml:math></disp-formula><disp-formula id="E4"><label>(4)</label><mml:math id="M4"><mml:mi>q</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003bb;</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tl</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>&#x0221d;</mml:mo><mml:mi mathvariant="italic">Gamma</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003bb;</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tl</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003b5;</mml:mo></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:munder><mml:mo stretchy="false">&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003c6;</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">it</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">il</mml:mi></mml:mrow><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>&#x003b6;</mml:mo></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:munder><mml:mo stretchy="false">&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003c6;</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">it</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:mfenced><mml:mi mathvariant="normal">&#x000a0;</mml:mi></mml:math></disp-formula></p><p>
<inline-formula id="IE2"><mml:math id="IM2"><mml:msubsup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">ik</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> is the <italic>k</italic>th Bernoulli feature of the <italic>i</italic>th observation and <inline-formula id="IE3"><mml:math id="IM3"><mml:msubsup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">il</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>p</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> is the <italic>l</italic>th Poisson feature of the <italic>i</italic>th observation. &#x003c6;<sub>it</sub> is the probability of the <italic>i</italic>th observation belonging to cluster <italic>t</italic>. We apply these updates for all <italic>t&#x02009;</italic>=<italic>&#x02009;</italic>1&#x02026;<italic>T</italic>, <italic>k&#x02009;</italic>=<italic>&#x02009;</italic>1&#x02026;<italic>r<sub>b</sub></italic> and l&#x02009;=&#x02009;1&#x02026;<italic>r<sub>p</sub></italic>.</p><p>We derived a novel variational inference algorithm to fit DPHM models with must-link constraints, outlined in Algorithm 1. In the algorithm, <inline-formula id="IE4"><mml:math id="IM4"><mml:msubsup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">ij</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>g</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></inline-formula> is the <italic>j</italic>th Gaussian feature of the <italic>i</italic>th observation and <italic>c<sub>-i</sub></italic> represents a vector of all cluster assignments except <italic>c<sub>i</sub></italic>. We define a must-link constraint as a set of indices for observations that must cluster together. In <xref ref-type="fig" rid="btz064-F1">Figure&#x000a0;1</xref> and Algorithm 1, <italic>M</italic> denotes a set of must-link constraints because the model can support multiple must-link constraints. While there are variational inference algorithms for semi-supervised classification models (<xref rid="btz064-B20" ref-type="bibr">Kingma <italic>et al.</italic>, 2014</xref>) with finite numbers of classes, and Gibbs samplers for semi-supervised infinite mixture models (<xref rid="btz064-B35" ref-type="bibr">Vlachos <italic>et al.</italic>, 2009</xref>), our work presents the first variational inference algorithm designed for semi-supervised infinite mixtures. In our algorithm, all observations in a particular must-link constraint are associated with a single cluster assignment variable, as shown in <xref ref-type="fig" rid="btz064-F1">Figure&#x000a0;1</xref>, so they are all assigned the same cluster. In each iteration of coordinate ascent, our algorithm updates variational densities of global latent variables (<italic>&#x003bc;, &#x003c4;, p, &#x003bb;</italic> and <italic>v</italic>) and uses their expectations to calculate cluster probability vectors. For each must-link constraint <italic>m</italic>, with observations <italic>X<sup>m</sup>=</italic><inline-formula id="IE23"><mml:math id="IM5"><mml:msub><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>&#x02208;</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> and cluster assignment <italic>c<sup>m</sup></italic> (the single cluster assignment variable for all observations in <italic>m</italic>), we derived the coordinate-optimal variational density of <italic>c<sup>m</sup></italic>:
<disp-formula id="E5"><label>(5)</label><mml:math id="M5"><mml:mi>q</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msup><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfenced><mml:mo>&#x0221d;</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="normal">exp</mml:mi></mml:mrow><mml:mo>&#x02061;</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo>[</mml:mo><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mo>[</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="normal">ln</mml:mi></mml:mrow><mml:mo>&#x02061;</mml:mo><mml:mrow><mml:mi>P</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msup><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:msup><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mo>&#x003bc;</mml:mo><mml:mo>,</mml:mo><mml:mo>&#x003c4;</mml:mo><mml:mo>,</mml:mo><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mo>&#x003bb;</mml:mo><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mrow><mml:mo>]</mml:mo><mml:mo>]</mml:mo></mml:mrow></mml:mrow><mml:mi mathvariant="normal">&#x000a0;</mml:mi></mml:math></disp-formula>
where <inline-formula id="IE24"><mml:math id="IM6"><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:msub></mml:math></inline-formula> is the expectation with respect to all latent variables except <italic>c<sup>m</sup></italic> and <italic>c<sup>&#x02212;m</sup></italic> is a vector of all cluster assignments except <italic>c<sup>m</sup></italic>. We obtain the cluster probability vector for the observations in <italic>m</italic> by evaluating the variational density over different clusters. Derivations for variational density updates are provided in the <xref ref-type="supplementary-material" rid="sup1">Supplementary Information</xref>.</p><p>
<boxed-text id="btz064-BOX1" position="float" orientation="portrait"><sec><title>Algorithm 1 Variational Inference for Semi-supervised DPHMs</title><p>1: Input: Data <italic>X</italic>, hyperparameters <italic>&#x003b1;, &#x003bd;, &#x003c1;, a, b, &#x003b3;, &#x003b4;, &#x003b5;, &#x003b6;</italic> and must-link constraints <italic>M</italic></p><p>2: Output: Variational posterior <italic>q(c, v, &#x000b5;, &#x003c4;, p, &#x003bb;)</italic></p><p>3: Initialize: for <italic>t&#x02009;=&#x02009;1..T</italic></p><p>&#x02003;&#x02003;&#x02003;<inline-formula id="IE5"><mml:math id="IM7"><mml:mi mathvariant="italic">q</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="italic">t</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c6;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">it</mml:mi></mml:mrow></mml:msub><mml:mi>&#x000a0;</mml:mi><mml:mi mathvariant="normal">where</mml:mi><mml:mi>&#x000a0;</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c6;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">i</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is a random probability vector for <italic>i</italic>&#x02009;=&#x02009;1&#x02009;..&#x02009;<italic>n</italic></p><p>&#x02003;&#x02003;&#x02003;<inline-formula id="IE6"><mml:math id="IM8"><mml:mi mathvariant="italic">q</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msup><mml:mrow><mml:mi mathvariant="italic">c</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">m</mml:mi></mml:mrow></mml:msup><mml:mo>=</mml:mo><mml:mi mathvariant="italic">t</mml:mi></mml:mrow></mml:mfenced><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c6;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">mt</mml:mi></mml:mrow></mml:msub><mml:mi>&#x000a0;</mml:mi><mml:mi mathvariant="normal">where</mml:mi><mml:mi>&#x000a0;</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c6;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">m</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula> is a random probability vector for <italic>m</italic>&#x02009;&#x02208;&#x02009;<italic>M</italic></p><p>&#x02003;&#x02003;&#x02003;<inline-formula id="IE7"><mml:math id="IM9"><mml:mi mathvariant="italic">q</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">v</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">t</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>&#x0221d;</mml:mo><mml:mi mathvariant="italic">Beta</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">v</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">t</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="italic">&#x003b1;</mml:mi><mml:mo>)</mml:mo></mml:math></inline-formula></p><p>&#x02003;&#x02003;&#x02003;<inline-formula id="IE8"><mml:math id="IM10"><mml:mi mathvariant="italic">q</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003bc;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tj</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tj</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>&#x0221d;</mml:mo><mml:mi mathvariant="italic">NG</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003bc;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tj</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tj</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003bd;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c1;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">a</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">b</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mi>&#x000a0;</mml:mi><mml:mi mathvariant="italic">for</mml:mi><mml:mi>&#x000a0;</mml:mi><mml:mi mathvariant="italic">j</mml:mi><mml:mo>=</mml:mo><mml:mn>1.</mml:mn><mml:mo>.</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">r</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">g</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula></p><p>&#x02003;&#x02003;&#x02003;<inline-formula id="IE9"><mml:math id="IM11"><mml:mi mathvariant="italic">q</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">p</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tk</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>&#x0221d;</mml:mo><mml:mi mathvariant="italic">Beta</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">p</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tk</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003b3;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">k</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003b4;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mi>&#x000a0;</mml:mi><mml:mi mathvariant="italic">for</mml:mi><mml:mi>&#x000a0;</mml:mi><mml:mi mathvariant="italic">k</mml:mi><mml:mo>=</mml:mo><mml:mn>1.</mml:mn><mml:mo>.</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">r</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">b</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula></p><p>&#x02003;&#x02003;&#x02003;<inline-formula id="IE10"><mml:math id="IM12"><mml:mi mathvariant="italic">q</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003bb;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tl</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>&#x0221d;</mml:mo><mml:mi mathvariant="italic">Gamma</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003bb;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tl</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003b5;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">l</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>&#x000a0;</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003b6;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">l</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mi>&#x000a0;</mml:mi><mml:mi mathvariant="italic">for</mml:mi><mml:mi>&#x000a0;</mml:mi><mml:mi mathvariant="italic">l</mml:mi><mml:mo>=</mml:mo><mml:mn>1.</mml:mn><mml:mo>.</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">r</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">p</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula></p><p>&#x02003;&#x02003;while ELBO not converged</p><p>&#x02003;&#x02003;&#x02003;Update variational densities for global latent variables. For <italic>t&#x02009;=&#x02009;1..T</italic></p><p>4:&#x02003;&#x02003;&#x02003;<inline-formula id="IE11"><mml:math id="IM13"><mml:mi mathvariant="italic">q</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">v</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">t</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>&#x0221d;</mml:mo><mml:mi mathvariant="italic">Beta</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">v</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">t</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mrow><mml:msubsup><mml:mo stretchy="false">&#x02211;</mml:mo><mml:mrow><mml:mi mathvariant="italic">i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi mathvariant="italic">n</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c6;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">it</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mi>&#x000a0;</mml:mi><mml:mi mathvariant="italic">&#x003b1;</mml:mi><mml:mo>+</mml:mo><mml:mrow><mml:msubsup><mml:mo stretchy="false">&#x02211;</mml:mo><mml:mrow><mml:mi mathvariant="italic">i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi mathvariant="italic">n</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mrow><mml:msubsup><mml:mo stretchy="false">&#x02211;</mml:mo><mml:mrow><mml:mi mathvariant="italic">s</mml:mi><mml:mo>=</mml:mo><mml:mi mathvariant="italic">t</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi mathvariant="italic">T</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c6;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">is</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:math></inline-formula></p><p>&#x02003;&#x02003;&#x02003;&#x02003;<inline-formula id="IE12"><mml:math id="IM14"><mml:mi mathvariant="normal">for</mml:mi><mml:mi>&#x000a0;</mml:mi><mml:mi mathvariant="italic">j</mml:mi><mml:mo>=</mml:mo><mml:mn>1.</mml:mn><mml:mo>.</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">r</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">g</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula></p><p>5:&#x02003;&#x02003;&#x02003;&#x02003;<inline-formula id="IE13"><mml:math id="IM15"><mml:mi mathvariant="italic">q</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003bc;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tj</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tj</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>&#x0221d;</mml:mo><mml:mi mathvariant="italic">NG</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003bc;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tj</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tj</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c1;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">j</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003bd;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:msubsup><mml:mo stretchy="false">&#x02211;</mml:mo><mml:mrow><mml:mi mathvariant="italic">i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi mathvariant="italic">n</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c6;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">it</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi mathvariant="italic">x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">ij</mml:mi></mml:mrow><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mi mathvariant="italic">g</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup></mml:mrow></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c1;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:msubsup><mml:mo stretchy="false">&#x02211;</mml:mo><mml:mrow><mml:mi mathvariant="italic">i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi mathvariant="italic">n</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c6;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">it</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:math></inline-formula></p><p>&#x02003;&#x02003;&#x02003;&#x02003;&#x02003;&#x02003;<inline-formula id="IE14"><mml:math id="IM16"><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c1;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:msubsup><mml:mo stretchy="false">&#x02211;</mml:mo><mml:mrow><mml:mi mathvariant="italic">i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi mathvariant="italic">n</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c6;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">it</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mi>&#x000a0;</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="italic">a</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mrow><mml:msubsup><mml:mo stretchy="false">&#x02211;</mml:mo><mml:mrow><mml:mi mathvariant="italic">i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi mathvariant="italic">n</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mi mathvariant="italic">&#x003c6;</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">it</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow><mml:mo>,</mml:mo></mml:math></inline-formula></p><p>&#x02003;&#x02003;&#x02003;&#x02003;<inline-formula id="IE15"><mml:math id="IM17"><mml:msub><mml:mrow><mml:mi>b</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mo stretchy="false">[</mml:mo><mml:mrow><mml:mrow><mml:msubsup><mml:mo stretchy="false">&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:msup><mml:mrow><mml:mo>[</mml:mo><mml:msub><mml:mrow><mml:mo>&#x003c6;</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">it</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msubsup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">ij</mml:mi></mml:mrow><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup><mml:mo>-</mml:mo><mml:mi mathvariant="double-struck">E</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003bc;</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tj</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>]</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mo>&#x003c1;</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msup><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003bc;</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tj</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mo>&#x003bd;</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mo stretchy="false">]</mml:mo><mml:mo>)</mml:mo></mml:math></inline-formula></p><p>&#x02003;&#x02003;&#x02003;&#x02003;<inline-formula id="IE16"><mml:math id="IM18"><mml:mi mathvariant="normal">for</mml:mi><mml:mi>&#x000a0;</mml:mi><mml:mi mathvariant="italic">k</mml:mi><mml:mo>=</mml:mo><mml:mn>1.</mml:mn><mml:mo>.</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">r</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">b</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula></p><p>6:&#x02003;&#x02003;&#x02003;&#x02003;<inline-formula id="IE17"><mml:math id="IM19"><mml:mi>q</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tk</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>&#x0221d;</mml:mo><mml:mi mathvariant="italic">Beta</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tk</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003b3;</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:msubsup><mml:mo stretchy="false">&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003c6;</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">it</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">ik</mml:mi></mml:mrow><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mo>&#x003b4;</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:msubsup><mml:mo stretchy="false">&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003c6;</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">it</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mo>(</mml:mo><mml:mn>1</mml:mn><mml:mo>-</mml:mo><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">ik</mml:mi></mml:mrow><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mfenced></mml:math></inline-formula></p><p>&#x02003;&#x02003;&#x02003;&#x02003;<inline-formula id="IE18"><mml:math id="IM20"><mml:mi mathvariant="normal">for</mml:mi><mml:mi>&#x000a0;</mml:mi><mml:mi mathvariant="italic">l</mml:mi><mml:mo>=</mml:mo><mml:mn>1.</mml:mn><mml:mo>.</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="italic">r</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">p</mml:mi></mml:mrow></mml:msub></mml:math></inline-formula></p><p>7:&#x02003;&#x02003;&#x02003;<inline-formula id="IE19"><mml:math id="IM21"><mml:mi>q</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003bb;</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tl</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mo>&#x0221d;</mml:mo><mml:mi mathvariant="italic">Gamma</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003bb;</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">tl</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003b5;</mml:mo></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:msubsup><mml:mo stretchy="false">&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003c6;</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">it</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">il</mml:mi></mml:mrow><mml:mrow><mml:mfenced separators="|"><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:msubsup></mml:mrow></mml:mrow><mml:mo>,</mml:mo><mml:mo>&#x000a0;</mml:mo><mml:msub><mml:mrow><mml:mo>&#x003b6;</mml:mo></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:msubsup><mml:mo stretchy="false">&#x02211;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mrow><mml:mo>&#x003c6;</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="italic">it</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mrow></mml:mfenced></mml:math></inline-formula></p><p>&#x02003;&#x02003;&#x02003;for any <italic>i</italic> not in a must-link constraint</p><p>8:&#x02003;&#x02003;&#x02003;<inline-formula id="IE20"><mml:math id="IM22"><mml:mi>q</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>&#x0221d;</mml:mo><mml:mi mathvariant="normal">exp</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mi mathvariant="normal">ln</mml:mi><mml:mo>&#x000a0;</mml:mo><mml:mi>P</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mo>&#x003bc;</mml:mo><mml:mo>,</mml:mo><mml:mo>&#x003c4;</mml:mo><mml:mo>,</mml:mo><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mo>&#x003bb;</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>)</mml:mo></mml:math></inline-formula></p><p>&#x02003;&#x02003;&#x02003;for each <inline-formula id="IE21"><mml:math id="IM23"><mml:mi mathvariant="italic">m</mml:mi><mml:mo>&#x02208;</mml:mo><mml:mi mathvariant="italic">M</mml:mi></mml:math></inline-formula></p><p>9:&#x02003;&#x02003;&#x02003;<inline-formula id="IE22"><mml:math id="IM24"><mml:mi>q</mml:mi><mml:mo>(</mml:mo><mml:msup><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:msup><mml:mo>)</mml:mo><mml:mo>&#x0221d;</mml:mo><mml:mi mathvariant="normal">exp</mml:mi><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="double-struck">E</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:msup><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:msub><mml:mfenced open="[" close="]" separators="|"><mml:mrow><mml:mi>ln</mml:mi><mml:mo>&#x000a0;</mml:mo><mml:mi>P</mml:mi><mml:mfenced separators="|"><mml:mrow><mml:msup><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi></mml:mrow></mml:msup><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mo>&#x003bc;</mml:mo><mml:mo>,</mml:mo><mml:mo>&#x003c4;</mml:mo><mml:mo>,</mml:mo><mml:mi>p</mml:mi><mml:mo>,</mml:mo><mml:mo>&#x003bb;</mml:mo><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mo>-</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:mfenced></mml:mrow></mml:mfenced><mml:mo>)</mml:mo></mml:math></inline-formula></p><p>10:&#x02003;&#x02003;Calculate <italic>ELBO</italic>[<italic>q</italic>(<italic>c, v, &#x000b5;, &#x003c4;, p, &#x003bb;</italic>)]</p><p>11: <bold>return</bold><italic>q(c, v, &#x000b5;, &#x003c4;, p, &#x003bb;)</italic></p></sec></boxed-text>
</p></sec></sec></sec><sec><title>3 Results</title><sec><title>3.1 Benchmarking the DPHM against other methods</title><p>To test whether the DPHM can outperform clustering models that assume Gaussian distributions over all features, we compared it to a finite Gaussian Mixture Model (GMM) and DPGM with the synthetic datasets (<xref ref-type="supplementary-material" rid="sup1">Supplementary Section S2.2.1</xref>). The DPHM model achieved significantly (Mann-Whitney U test <italic>P</italic>&#x02009;&#x0003c;&#x02009;0.05) higher Adjusted Rand Indices (ARIs) (<xref rid="btz064-B18" ref-type="bibr">Hubert and Arabie, 1985</xref>) than the GMM and DPGM on all synthetic datasets in unsupervised and semi-supervised settings (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S1</xref>&#x02009;A, <italic>P</italic>-values shown in <xref ref-type="supplementary-material" rid="sup1">Supplementary Table S2</xref>), which shows the advantage of incorporating Bernoulli and Poisson distributions into the DPHM model. To determine if the DPHM can outperform a distance-based clustering algorithm, we compared it to k-means with the synthetic datasets and gave k-means the correct numbers of clusters. Against unsupervised k-means, the unsupervised DPHM achieved significantly higher ARIs on the 10 and 25-cluster datasets but there was no significant difference on the 50-cluster dataset. Against constrained k-means (<xref rid="btz064-B36" ref-type="bibr">Wagstaff <italic>et al.</italic>, 2001</xref>), the semi-supervised DPHM achieved significantly higher ARIs on the 25-cluster dataset but there were no significant differences on the 10 and 50-cluster datasets. The performances of the DPHM and k-means were comparable on certain datasets and settings when k-means was given the correct numbers of clusters.</p><p>Since constrained k-means performed well on the synthetic datasets when k was given, we applied the DPHM and constrained k-means to a biological dataset (Nkx2-5 dataset) to evaluate their power to predict held-out VISTA enhancers (<xref ref-type="supplementary-material" rid="sup1">Supplementary Section S2.2.2</xref>). For each training set, we applied constrained k-means with different values of k and initial parameters and picked the setting which maximized the average silhouette (<xref rid="btz064-B30" ref-type="bibr">Rousseeuw, 1987</xref>). Across all training sets, constrained k-means predicted positive clusters that were an order of magnitude larger than the DPHM (<xref ref-type="fig" rid="btz064-F2">Fig.&#x000a0;2A</xref>) and achieved higher sensitivity lower bounds (SLBs) than the DPHM (<xref ref-type="fig" rid="btz064-F2">Fig.&#x000a0;2B</xref>). The DPHM achieved higher precision lower bounds (PLBs) than constrained k-means (Mann-Whitney U test <italic>P</italic>&#x02009;&#x0003c;&#x02009;0.05 for training set sizes between 10 and 90, inclusive, see <xref ref-type="supplementary-material" rid="sup1">Supplementary Table S3</xref> for <italic>P</italic>-values) (<xref ref-type="fig" rid="btz064-F2">Fig.&#x000a0;2C</xref>). Taken together, these results show that regions appearing in the DPHM&#x02019;s positive cluster are more likely to be experimentally validated enhancers and that the two methods have qualitatively different predictive performances.
</p><fig id="btz064-F2" orientation="portrait" position="float"><label>Fig. 2.</label><caption><p>(<bold>A</bold>) Sizes of positive clusters (the cluster with the training set) predicted by the DPHM (dark trace) and constrained k-means (light trace) across training set sizes. The y-axis is log-scaled. For each training set size, both models were run five times with five different training sets. The plot shows mean positive cluster sizes and error bars represent one standard deviation across training sets. (<bold>B</bold>) Sensitivity lower bounds achieved by the DPHM (dark trace) and constrained k-means (light trace) with different training set sizes. The plots shows the mean and error bars representing one standard deviation across training sets. (<bold>C</bold>) Precision lower bounds achieved by the DPHM (dark trace) and constrained k-means (light trace) with different training set sizes. The plot shows the mean and error bars representing one standard deviation across training sets. (<bold>D</bold>) A comparison of the numbers of PAEs from the unsupervised DPHM model (with 0 regions in the must-link constraint) and semi-supervised DPHM models with differing training set sizes. For semi-supervised models with 10&#x02013;100 regions in their training set, we randomly sampled their training sets, from the VISTA enhancers five times and calculated the average number of PAEs, across the samples, for each training set size (dark bars). In addition, for each training set size, we calculated the average number of PAEs that were also in the set of SDPHM-PAEs (light bars). Standard deviations, for the numbers of PAEs and SDPHM-PAEs, across sampled training sets were also calculated (black lines)</p></caption><graphic xlink:href="btz064f2"/></fig><p>Finally, we tested the DPHM in a fully supervised learning paradigm. To do so, we considered all VISTA enhancers as the &#x02018;positive set&#x02019; and all other regions as the &#x02018;negative set&#x02019; and trained standard machine learning classifiers (<xref ref-type="supplementary-material" rid="sup1">Supplementary Section S2.2.3</xref>). To fit the parameters of the variational distribution of the fully supervised DPHM model, we created two must-link constraints corresponding to positives and negatives. We then allow all the VISTA enhancers to join either the positive or negative class. We evaluate the sensitivity of the methods in training and held-out VISTA enhancers. In this context, the DPHM is a generative model that assumes independence among features, and as expected, we found that the DPHM achieved similar performance to Naive Bayes (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S1B</xref>). Of the methods we tried, AdaBoost showed the best performance in the fully supervised paradigm, achieving perfect sensitivities (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S1B</xref>).</p></sec><sec><title>3.2 Sensitivity to the training set</title><p>We performed a sensitivity analysis (<xref ref-type="supplementary-material" rid="sup1">Supplementary Section S2.3</xref>) to analyze how predicted active enhancers (PAEs) change as we tune the training set of the DPHM. We applied a semi-supervised DPHM model to the mouse heart dataset and trained the model on the complete training set. It discovered 47 PAEs [hereafter referred to as the semi-supervised DPHM&#x02019;s predicted active enhancers (SDPHM-PAEs)] and most displayed epigenetic marks (<xref rid="btz064-B12" ref-type="bibr">Ernst <italic>et al.</italic>, 2011</xref>) of active enhancers (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S2A</xref>). Gene ontology (GO) enrichment analysis (<xref ref-type="supplementary-material" rid="sup1">Supplementary Section S2.4</xref>) revealed that the nearest genes of the SDPHM-PAEs were significantly enriched for expression in heart ventricle during postnatal development in mouse (q&#x02009;=&#x02009;3.98&#x02009;&#x000d7;&#x02009;10<sup>&#x02212;2</sup>), suggesting that the semi-supervised model may predict heart-specific active enhancers. One SDPHM-PAE, located 1322&#x02009;bp upstream from the transcription start site (TSS) of Actc1 (a gene that transcribes cardiac alpha-actin), was previously functionally validated and confirmed to drive Actc1 expression (<xref rid="btz064-B13" ref-type="bibr">Fleischmann <italic>et al.</italic>, 1998</xref>). Sensitivity analysis showed that the DPHM model can predict over half of the SDPHM-PAEs with 70 or more VISTA enhancers in the must-link constraint (<xref ref-type="fig" rid="btz064-F2">Fig.&#x000a0;2D</xref>). Furthermore, the SDPHM-PAE near Actc1 was predicted to be an active enhancer for at least 3/5 training set samples with 70 or more VISTA enhancers in the must-link constraint.</p><p>For comparison, we applied an unsupervised DPHM to the mouse heart dataset and found that the cluster with the most VISTA enhancers had 17 VISTA enhancers and 104 PAEs. These PAEs had some marks of active enhancers (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S2B</xref>) although their average H3K27 acetylation (K27ac) signal (minmax-scaled K27ac features averaged across time points and PAEs) was significantly (one-sided t-test <italic>P</italic>&#x02009;=&#x02009;8.81&#x02009;&#x000d7;&#x02009;10<sup>&#x02212;4</sup>) lower than the average K27ac signal of SDPHM-PAEs. The nearest genes of the PAEs from the unsupervised model were not significantly (q&#x02009;&#x0003c;&#x02009;0.05) enriched with any GO terms, suggesting that the unsupervised model could not predict enhancers near heart-specific genes. The results for the semi-supervised and unsupervised DPHM models indicate that the training data may allow the DPHM model to predict heart-specific enhancers with stronger activity.</p></sec><sec><title>3.3 Clustering the clusters</title><p>The semi-supervised DPHM model that was trained on the complete training set found 47 clusters in the Nkx2-5 dataset. In addition to the 47 SDPHM-PAEs, other clusters also contained regions with characteristics of active enhancers. Furthermore, groups of clusters shared characteristics of different enhancer states. We wanted to group similar clusters together using another clustering model. To this end, we represented each cluster (from the semi-supervised DPHM model that was trained on the complete training set) with a feature vector of expected values over its cluster-specific distribution parameters; all the values are continuous. We applied a DPGM (&#x02018;dphmix&#x02019; runs a DPGM when all features are continuous) with &#x003b1;&#x02009;=&#x02009;1 to group the clusters and found 14 classes (clusters of the original 47 clusters). Since the VISTA enhancers were forced to cluster together, they appeared in the same class. There are five large (over 500 regions) classes that we number from 1 to 5 as shown in <xref ref-type="fig" rid="btz064-F3">Figure&#x000a0;3A</xref>. We performed GO enrichment analysis (<ext-link ext-link-type="uri" xlink:href="https://pypi.org/project/dphmix/">Supplementary Section S2.4</ext-link>) on each class to identify possible functions of their regions. Here, we analyze an interesting large class (class 2). Analyses for the other four large classes are provided in the <xref ref-type="supplementary-material" rid="sup1">Supplementary Information</xref>. In particular, class 3 contains regions with characteristics of active promoters (<xref rid="btz064-B12" ref-type="bibr">Ernst <italic>et al.</italic>, 2011</xref>) and class 4 contains regions appearing to be inactive regions or decommissioned enhancers (<xref rid="btz064-B28" ref-type="bibr">Pradeepa, 2017</xref>).
</p><fig id="btz064-F3" orientation="portrait" position="float"><label>Fig. 3.</label><caption><p>(<bold>A</bold>) A heatmap showing the regions in the large classes. Each column represents an ENCODE feature in heart tissues and they were minmax-scaled to be between 0 and 1. (<bold>B</bold>) A heatmap showing the enrichment (regression coefficient) of JASPAR motifs in classes 1, 2, 3 and 5 compared to class 4 (predicted inactive regions). The vertical sizes of each row are proportional to the number of regions in the class corresponding to the rows in panel (A). Only motifs that have a significant (<italic>P</italic>&#x02009;&#x0003c;&#x02009;0.05) and positive coefficient for at least one class compared to class 4 are included. Coefficients for class 4 are not available since it was used as the reference class for all the regressions</p></caption><graphic xlink:href="btz064f3"/></fig><p>We associated class 2 with active enhancers as it contains the cluster with all of the VISTA enhancers. We refer to this class as the DPHM&#x02019;s active enhancer class (DPHM-AEC). It also contains 4 other clusters for a total of 741 regions. It has the highest average H3K4 mono-methylation (K4me1) signal (minmax-scaled mouse K4me1 features averaged across time points and regions in the class) and second highest average K27ac signal in embryonic mouse tissue among all classes. Consistent with typical active enhancers, P300 and POL2 were bound to the vast majority of the regions in adult tissue (<xref rid="btz064-B32" ref-type="bibr">Spicuglia and Vanhille, 2012</xref>). GO annotation analysis on genes near (within 1&#x02009;Mb) regions from the DPHM-AEC revealed 100 significantly enriched biological processes. To ensure that the observed enrichments were not biased by VISTA enhancers, we conducted GO enrichment analysis on the regions in the class that are not in VISTA. The regions were still significantly enriched with 6/100 of the aforementioned processes, suggesting that they may be novel active enhancers with similar functions as VISTA enhancers.</p><sec><title>3.3.1 Comparison to classes discovered by constrained k-means</title><p>To determine if constrained k-means can discover classes of enhancers, we applied constrained k-means on the Nkx2-5 dataset with a must-link constraint on all 109 VISTA enhancers. Maximizing the average silhouette yielded k&#x02009;=&#x02009;2 classes (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S3A</xref>). One class contains regions that appear to be active promoters while the other class contains all other regions, including the VISTA enhancers (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S3B</xref>). Neither class was significantly (q&#x02009;&#x0003c;&#x02009;0.05) enriched with any biological processes. Hence, if k is chosen to maximize the average silhouette, constrained k-means may separate enhancers from promoters but it could not discover different states of enhancers. This illustrates the advantage of the DPHM, which appears to identify multiple biologically relevant classes with characteristics of different enhancer states.</p><p>Next, we applied constrained k-means with k&#x02009;=&#x02009;14 (to match the number of classes found by the DPHM). Constrained k-means found three large classes. Two of these contain a mixture of regions with characteristics of poised, primed, weak, inactive and decommissioned enhancers (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S3C</xref>, red and cyan bars). The other large class had the VISTA enhancers so we refer to this class as the constrained k-means&#x02019; active enhancer class (CKM-AEC). Regions in the CKM-AEC had characteristics of active enhancers (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S3C</xref>). The genes near regions from the CKM-AEC were not significantly (q&#x02009;&#x0003c;&#x02009;0.05) enriched with any processes that were enriched in VISTA enhancers whereas 2 heart-specific processes enriched in the DPHM-AEC were enriched in VISTA enhancers (Supplementary Files: class2_noVISTA_SigProcesses and ckm_aec_noVISTA_SigProcesses), supporting the idea that the DPHM has more power to predict heart-specific active enhancers even when k was given. Most of the regions that appeared to be active promoters (class 3 found by the DPHM) are now dispersed over five other classes found by constrained k-means. The analysis reveals that constrained k-means can identify different classes of enhancers, given the right k, but the classes appear less specific than those found by the DPHM.</p></sec><sec><title>3.3.2 Motif enrichment analysis of classes</title><p>We next sought to identify transcription factors (TFs) whose motif matches were differentially enriched (conserved across 6 mammals) between class 4 (predicted inactive regions) and each other class identified by the DPHM (<ext-link ext-link-type="uri" xlink:href="https://pypi.org/project/dphmix/">Supplementary Section S2.5</ext-link>). To our surprise, each class was enriched with at least 60 TF motifs. The 86 TFs whose motif matches were enriched in the DPHM-AEC were significantly (q&#x02009;&#x0003c;&#x02009;0.05) enriched for 17 biological processes, including regulation of muscle system process (q&#x02009;=&#x02009;6.59&#x02009;&#x000d7;&#x02009;10<sup>&#x02212;3</sup>). The TFs for other classes were not significantly enriched with any processes, suggesting that the TFs uniquely enriched in the DPHM-AEC may preferentially bind to active enhancers and facilitate biological processes in the developing mouse heart. While 80 motifs are enriched in multiple classes (shared motifs), each class is uniquely enriched with at least 7 motifs (<xref ref-type="fig" rid="btz064-F3">Fig.&#x000a0;3B</xref>) suggesting that many different TFs may be required to determine enhancer states. We repeated this analysis using multinomial regression and found similar results (<xref ref-type="supplementary-material" rid="sup1">Supplementary Fig. S4</xref>).</p></sec></sec></sec><sec><title>4 Discussion</title><p>We derived the semi-supervised variational DPHM model to cluster heterogeneous data with must-link constraints using a Bayesian framework. We showed that the DPHM and constrained k-means have qualitatively different predictive performances on biological data and that the DPHM achieves higher precision lower bounds, which is important in enhancer prediction because false positives are costly in experimental validation. We used the DPHM to cluster genomic regions bound by a master regulator in embryonic mouse heart based on heterogeneous ENCODE features and predicted the most similar regions to a set of known active enhancers. Further studies will determine whether other epigenomics datasets (<xref rid="btz064-B29" ref-type="bibr">Roadmap Epigenomics Consortium <italic>et al.</italic>, 2015</xref>; <xref rid="btz064-B26" ref-type="bibr">Noguchi <italic>et al.</italic>, 2017</xref>) and positive enhancers identified through self-transcribing active regulatory region sequencing (STARR-seq) (<xref rid="btz064-B23" ref-type="bibr">Liu <italic>et al.</italic>, 2017</xref>) can potentially be utilized to train DPHMs and predict states of new enhancer candidates.</p><p>Clustering the clusters revealed multiple functional classes of enhancers in the Nkx2-5 ChIP-seq dataset, and motif enrichment analysis suggested that many different motifs may be required to discriminate the classes from each other. Experimental validation is required to determine if the motifs uniquely enriched in specific classes control different enhancer states and whether multiple binding events are required for enhancers to transition from an inactive state to a functional state. However, there are examples of multiple TF binding events driving expression of the Hbb gene to facilitate cell fate transitions (<xref rid="btz064-B7" ref-type="bibr">Capellera-Garcia <italic>et al.</italic>, 2016</xref>; <xref rid="btz064-B24" ref-type="bibr">Mitchell <italic>et al.</italic>, 2012</xref>).</p><p>Our semi-supervised DPHM approach solves a different problem than other enhancer prediction methods (<xref rid="btz064-B11" ref-type="bibr">Ernst and Kellis, 2012</xref>; <xref rid="btz064-B17" ref-type="bibr">Hoffman <italic>et al.</italic>, 2012</xref>; <xref rid="btz064-B14" ref-type="bibr">He <italic>et al.</italic>, 2017</xref>; <xref rid="btz064-B21" ref-type="bibr">Li <italic>et al.</italic>, 2018</xref>) as it predicts enhancer states from a set of bound regions. In the fully supervised paradigm, we found AdaBoost was better at predicting held-out VISTA enhancers, but this is not the recommended use case for our model: the DPHM was designed to predict an unbounded number of enhancer states. Supervised enhancer classifiers can only predict classes that are present in the training set. To separate active enhancers from inactive enhancers, they require labelled training examples of active and inactive enhancers. While training regions can be labelled based on the presence of certain histone marks, TF binding or enhancer RNA expression, these are neither necessary nor sufficient for enhancer activity (<xref rid="btz064-B8" ref-type="bibr">Catarino and Stark, 2018</xref>). The advantage of the semi-supervised approach is to predict multiple classes even when the training set only includes validated active enhancers. Consistent with this, we also showed that constrained k-means can predict enhancer classes, but requires a priori information about the number of classes. Moreover, although the predicted active enhancers from the unsupervised DPHM model were weaker candidates compared to those from the supervised DPHM, the enhancer marks suggest that even the unsupervised model can be used to predict enhancer classes.</p><p>One of the advantages of an infinite mixture model over a finite mixture model is that the number of hyperparameters in an infinite mixture model only scales with the number of features, whereas, in a finite mixture model, it scales with the number of features and clusters. Our DPHM model has 1&#x02009;+&#x02009;4<italic>r<sub>g</sub></italic> + 2<italic>r<sub>b</sub></italic> + 2&#x02009;<italic>r<sub>p</sub></italic> hyperparameters, while a GMM with diagonal covariance, would have <italic>k&#x02009;</italic>&#x02212;<italic>&#x02009;</italic>1&#x02009;+&#x02009;2<italic>k</italic>(<italic>r<sub>g</sub> + r<sub>b</sub> + r<sub>p</sub></italic>), where <italic>k</italic> is the number of clusters. Hence, the DPHM model reduces the number of hyperparameters by a factor of order <italic>k</italic>, which can be substantial if <italic>k</italic> is large. Instead of variational inference, DPHMs can also be fit with Markov Chain Monte Carlo methods (<xref rid="btz064-B25" ref-type="bibr">Neal, 2000</xref>), but convergence is difficult to assess and not guaranteed in a finite number of iterations. We implemented a Gibbs sampler (<xref rid="btz064-B35" ref-type="bibr">Vlachos <italic>et al.</italic>, 2009</xref>) to fit the semi-supervised DPHM, but found that our implementation was numerically unstable when the data had a large number of features.</p><p>Further work is required to determine whether our DPHM model is viable for clustering regions genome-wide based on chromatin state. The algorithm is <italic>O(Tn)</italic> as it passes through the entire dataset and all clusters to update cluster probability vectors, but would still require a large amount of time for large datasets as it has to complete a full pass over the dataset at each iteration of coordinate ascent. Moreover, there is substantial overhead in gathering files, extracting features for every genomic region and exhaustively testing different priors. Stochastic variational inference could speed up the algorithm for larger datasets as it allows some variational parameters to be updated based on subsamples of the data (<xref rid="btz064-B16" ref-type="bibr">Hoffman <italic>et al.</italic>, 2013</xref>).</p><p>The purpose of clustering the clusters was to reduce the number of clusters, but, in principle, this can also be accomplished by tuning &#x003b1;. For large datasets, however, &#x003b1; has a marginal effect on the number of clusters, because variational densities for the stick-breaking variables are primarily determined by cluster probabilities rather than &#x003b1; (line 4 of Algorithm 1). The clustering of clusters is a novel, model-based method to hierarchically cluster data in a multi-way tree structure. <xref rid="btz064-B4" ref-type="bibr">Blundell <italic>et al.</italic> (2010)</xref> derived a hierarchical clustering algorithm that produces multi-way trees, but the algorithm is <italic>O(n<sup>2</sup>log n)</italic>, so it may have difficulties scaling to large data. In contrast, even for hierarchical clustering, our method is still <italic>O(Tn)</italic>, as each layer of clustering is done independently and only adds terms of order n to the time complexity. Nonetheless, our method is heuristic and further work is needed to create a principled, scalable Bayesian hierarchical clustering model.</p></sec><sec><title>5 Conclusion</title><p>In this paper, we derived the DPHM model to cluster genomic regions bound by a master regulator in embryonic mouse heart based on heterogeneous features. In addition, we derived a variational inference algorithm to force known active enhancers to cluster together. The semi-supervised DPHM model discovered 47 regions that were similar to the known active enhancers and near heart-specific genes. Furthermore, we clustered the clusters from the DPHM model to find five large classes of enhancers with distinct patterns over their features. The class with the known active enhancers was enriched with heart-specific biological processes and TF-binding motifs that are important for muscle system processes. The other functional classes of enhancers were also enriched with many different TF-binding motifs. Our results show that the semi-supervised DPHM model provides a principled Bayesian method for clustering heterogeneous data with small training sets.</p></sec><sec sec-type="supplementary-material"><title>Supplementary Material</title><supplementary-material content-type="local-data" id="sup1"><label>btz064_Supplementary_Data</label><media xlink:href="btz064_supplementary_data.zip"><caption><p>Click here for additional data file.</p></caption></media></supplementary-material></sec></body><back><ack id="ack1"><title>Acknowledgements</title><p>We thank Rachel Chan, Lee Zamparo, Dr. Michael Hoffman and the members of the Moses Lab for helpful comments on the manuscript.</p><sec><title>Funding</title><p>This work was supported by the Natural Sciences and Engineering Research Council of Canada (NSERC) discovery grants (to AMM and JAM), and infrastructure grants from the Canada Foundation for Innovation and the Ontario Ministry of Research and Innovation (to AMM). Studentship funding to support this work was provided by Connaught International Scholarships (GS).</p><p>
<italic>Conflict of Interest</italic>: none declared.</p></sec></ack><ref-list id="ref1"><title>References</title><ref id="btz064-B1"><mixed-citation publication-type="other">
<person-group person-group-type="author"><name name-style="western"><surname>Beal</surname><given-names>M.</given-names></name></person-group> (<year>2003</year>) Variational Algorithms for Approximate Bayesian Inference. PhD Thesis, Gatsby Computational Neuroscience Unit, University College London.</mixed-citation></ref><ref id="btz064-B2"><mixed-citation publication-type="book">
<person-group person-group-type="author"><name name-style="western"><surname>Bishop</surname><given-names>C.M.</given-names></name></person-group> (<year>2006</year>) <source>Pattern Recognition and Machine Learning</source>. 
<publisher-name>Springer</publisher-name>, 
<publisher-loc>New York</publisher-loc>.</mixed-citation></ref><ref id="btz064-B3"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Blei</surname><given-names>D.M.</given-names></name>, <name name-style="western"><surname>Jordan</surname><given-names>M.I.</given-names></name></person-group> (<year>2006</year>) 
<article-title>Variational inference for dirichlet process mixtures</article-title>. <source>Bayesian Anal</source>., <volume>1</volume>, <fpage>121</fpage>&#x02013;<lpage>143</lpage>.</mixed-citation></ref><ref id="btz064-B4"><mixed-citation publication-type="book">
<person-group person-group-type="author"><name name-style="western"><surname>Blundell</surname><given-names>C.</given-names></name></person-group>
<etal>et al</etal> (<year>2010</year>) <chapter-title>Bayesian rose trees</chapter-title> In: <source>Proceedings of the Twenty-Sixth Conference on Uncertainty in Artificial Intelligence, UAI&#x02019;10</source>. 
<publisher-name>AUAI Press</publisher-name>, 
<publisher-loc>Arlington, Virginia, US</publisher-loc>, pp. <fpage>65</fpage>&#x02013;<lpage>72</lpage>.</mixed-citation></ref><ref id="btz064-B5"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Bulger</surname><given-names>M.</given-names></name>, <name name-style="western"><surname>Groudine</surname><given-names>M.</given-names></name></person-group> (<year>2011</year>) 
<article-title>Functional and mechanistic diversity of distal transcription enhancers</article-title>. <source>Cell</source>, <volume>144</volume>, <fpage>327</fpage>&#x02013;<lpage>339</lpage>.<pub-id pub-id-type="pmid">21295696</pub-id></mixed-citation></ref><ref id="btz064-B6"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Calo</surname><given-names>E.</given-names></name>, <name name-style="western"><surname>Wysocka</surname><given-names>J.</given-names></name></person-group> (<year>2013</year>) 
<article-title>Modification of enhancer chromatin: what, how, and why?</article-title><source>Mol. Cell</source>, <volume>49</volume>, <fpage>825</fpage>&#x02013;<lpage>837</lpage>.<pub-id pub-id-type="pmid">23473601</pub-id></mixed-citation></ref><ref id="btz064-B7"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Capellera-Garcia</surname><given-names>S.</given-names></name></person-group>
<etal>et al</etal> (<year>2016</year>) 
<article-title>Defining the minimal factors required for erythropoiesis through direct lineage conversion</article-title>. <source>Cell Rep</source>., <volume>15</volume>, <fpage>2550</fpage>&#x02013;<lpage>2562</lpage>.<pub-id pub-id-type="pmid">27264182</pub-id></mixed-citation></ref><ref id="btz064-B8"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Catarino</surname><given-names>R.R.</given-names></name>, <name name-style="western"><surname>Stark</surname><given-names>A.</given-names></name></person-group> (<year>2018</year>) 
<article-title>Assessing sufficiency and necessity of enhancer activities for gene expression and the mechanisms of transcription activation</article-title>. <source>Genes Dev</source>., <volume>32</volume>, <fpage>202</fpage>&#x02013;<lpage>223</lpage>.<pub-id pub-id-type="pmid">29491135</pub-id></mixed-citation></ref><ref id="btz064-B9"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Dupays</surname><given-names>L.</given-names></name></person-group>
<etal>et al</etal> (<year>2015</year>) 
<article-title>Sequential binding of meis1 and nkx2-5 on the popdc2 gene: a mechanism for spatiotemporal regulation of enhancers during cardiogenesis</article-title>. <source>Cell Rep</source>., <volume>13</volume>, <fpage>183</fpage>&#x02013;<lpage>195</lpage>.<pub-id pub-id-type="pmid">26411676</pub-id></mixed-citation></ref><ref id="btz064-B10"><mixed-citation publication-type="journal">ENCODE Project Consortium (<year>2012</year>) 
<article-title>An integrated encyclopedia of dna elements in the human genome</article-title>. <source>Nature</source>, <volume>489</volume>, <fpage>57</fpage>&#x02013;<lpage>74</lpage>.<pub-id pub-id-type="pmid">22955616</pub-id></mixed-citation></ref><ref id="btz064-B11"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Ernst</surname><given-names>J.</given-names></name>, <name name-style="western"><surname>Kellis</surname><given-names>M.</given-names></name></person-group> (<year>2012</year>) 
<article-title>Chromhmm: automating chromatin-state discovery and characterization</article-title>. <source>Nat. Methods</source>, <volume>9</volume>, <fpage>215</fpage>&#x02013;<lpage>216</lpage>.<pub-id pub-id-type="pmid">22373907</pub-id></mixed-citation></ref><ref id="btz064-B12"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Ernst</surname><given-names>J.</given-names></name></person-group>
<etal>et al</etal> (<year>2011</year>) 
<article-title>Mapping and analysis of chromatin state dynamics in nine human cell types</article-title>. <source>Nature</source>, <volume>473</volume>, <fpage>43</fpage>&#x02013;<lpage>49</lpage>.<pub-id pub-id-type="pmid">21441907</pub-id></mixed-citation></ref><ref id="btz064-B13"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Fleischmann</surname><given-names>M.</given-names></name></person-group>
<etal>et al</etal> (<year>1998</year>) 
<article-title>Cardiac specific expression of the green fluorescent protein during early murine embryonic development</article-title>. <source>FEBS Lett</source>., <volume>440</volume>, <fpage>370</fpage>&#x02013;<lpage>376</lpage>.<pub-id pub-id-type="pmid">9872405</pub-id></mixed-citation></ref><ref id="btz064-B14"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>He</surname><given-names>Y.</given-names></name></person-group>
<etal>et al</etal> (<year>2017</year>) 
<article-title>Improved regulatory element prediction based on tissue-specific local epigenomic signatures</article-title>. <source>Proc. Natl. Acad. Sci. USA</source>, <volume>114</volume>, <fpage>E1633</fpage>&#x02013;<lpage>E1640</lpage>.<pub-id pub-id-type="pmid">28193886</pub-id></mixed-citation></ref><ref id="btz064-B15"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Hinrichs</surname><given-names>A.</given-names></name></person-group>
<etal>et al</etal> (<year>2006</year>) 
<article-title>The ucsc genome browser database: update 2006</article-title>. <source>Nucleic Acids Res</source>., <volume>34</volume>, <fpage>D590</fpage>&#x02013;<lpage>D598</lpage>.<pub-id pub-id-type="pmid">16381938</pub-id></mixed-citation></ref><ref id="btz064-B16"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Hoffman</surname><given-names>M.D.</given-names></name></person-group>
<etal>et al</etal> (<year>2013</year>) 
<article-title>Stochastic variational inference</article-title>. <source>J. Mach. Learn. Res</source>., <volume>14</volume>, <fpage>1303</fpage>&#x02013;<lpage>1347</lpage>.</mixed-citation></ref><ref id="btz064-B17"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Hoffman</surname><given-names>M.M.</given-names></name></person-group>
<etal>et al</etal> (<year>2012</year>) 
<article-title>Unsupervised pattern discovery in human chromatin structure through genomic segmentation</article-title>. <source>Nat. Methods</source>, <volume>9</volume>, <fpage>473</fpage>&#x02013;<lpage>476</lpage>.<pub-id pub-id-type="pmid">22426492</pub-id></mixed-citation></ref><ref id="btz064-B18"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Hubert</surname><given-names>L.</given-names></name>, <name name-style="western"><surname>Arabie</surname><given-names>P.</given-names></name></person-group> (<year>1985</year>) 
<article-title>Comparing partitions</article-title>. <source>J. Classif</source>., <volume>2</volume>, <fpage>193</fpage>&#x02013;<lpage>218</lpage>.</mixed-citation></ref><ref id="btz064-B19"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Ishwaran</surname><given-names>H.</given-names></name>, <name name-style="western"><surname>James</surname><given-names>L.F.</given-names></name></person-group> (<year>2001</year>) 
<article-title>Gibbs sampling methods for stick breaking priors</article-title>. <source>J. Am. Stat. Assoc</source>., <volume>96</volume>, <fpage>161</fpage>&#x02013;<lpage>173</lpage>.</mixed-citation></ref><ref id="btz064-B20"><mixed-citation publication-type="other">
<person-group person-group-type="author"><name name-style="western"><surname>Kingma</surname><given-names>D.P.</given-names></name></person-group>
<etal>et al</etal> (<year>2014</year>) Semi-supervised learning with deep generative models. In: <source>Proceedings of the 27th International Conference on Neural Information Processing Systems</source>. Vol. 2. NIPS'14. MIT Press, Cambridge, Massachusetts, US, pp. <fpage>3581</fpage>&#x02013;<lpage>3589</lpage>.</mixed-citation></ref><ref id="btz064-B21"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Li</surname><given-names>Y.</given-names></name></person-group>
<etal>et al</etal> (<year>2018</year>) 
<article-title>Genome-wide prediction of cis-regulatory regions using supervised deep learning methods</article-title>. <source>BMC Bioinformatics</source>, <volume>19</volume>, <fpage>202</fpage>. <pub-id pub-id-type="pmid">29855387</pub-id></mixed-citation></ref><ref id="btz064-B22"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Lim</surname><given-names>K.-L.</given-names></name>, <name name-style="western"><surname>Wang</surname><given-names>H.</given-names></name></person-group> (<year>2018</year>) 
<article-title>Fast approximation of variational bayes dirichlet process mixture using the maximization&#x02013;maximization algorithm</article-title>. <source>Int. J. Appr. Reason</source>., <volume>93</volume>, <fpage>153</fpage>&#x02013;<lpage>177</lpage>.</mixed-citation></ref><ref id="btz064-B23"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Liu</surname><given-names>Y.</given-names></name></person-group>
<etal>et al</etal> (<year>2017</year>) 
<article-title>Functional assessment of human enhancer activities using whole-genome STARR-sequencing</article-title>. <source>Genome Biol</source>., <volume>18</volume>, <fpage>219.</fpage><pub-id pub-id-type="pmid">29151363</pub-id></mixed-citation></ref><ref id="btz064-B24"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Mitchell</surname><given-names>J.A.</given-names></name></person-group>
<etal>et al</etal> (<year>2012</year>) 
<article-title>Nuclear rna sequencing of the mouse erythroid cell transcriptome</article-title>. <source>PLoS One</source>, <volume>7</volume>, <fpage>e49274.</fpage><pub-id pub-id-type="pmid">23209567</pub-id></mixed-citation></ref><ref id="btz064-B25"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Neal</surname><given-names>R.M.</given-names></name></person-group> (<year>2000</year>) 
<article-title>Markov chain sampling methods for dirichlet process mixture models</article-title>. <source>J. Comput. Graph. Stat</source>., <volume>9</volume>, <fpage>249</fpage>&#x02013;<lpage>265</lpage>.</mixed-citation></ref><ref id="btz064-B26"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Noguchi</surname><given-names>S.</given-names></name></person-group>
<etal>et al</etal> (<year>2017</year>) 
<article-title>Fantom5 cage profiles of human and mouse samples</article-title>. <source>Sci. Data</source>, <volume>4</volume>, <fpage>170112</fpage>.<pub-id pub-id-type="pmid">28850106</pub-id></mixed-citation></ref><ref id="btz064-B27"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Pennacchio</surname><given-names>L.A.</given-names></name></person-group>
<etal>et al</etal> (<year>2007</year>) 
<article-title>Predicting tissue-specific enhancers in the human genome</article-title>. <source>Genome Res</source>., <volume>17</volume>, <fpage>201</fpage>&#x02013;<lpage>211</lpage>.<pub-id pub-id-type="pmid">17210927</pub-id></mixed-citation></ref><ref id="btz064-B28"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Pradeepa</surname><given-names>M.M.</given-names></name></person-group> (<year>2017</year>) 
<article-title>Causal role of histone acetylations in enhancer function</article-title>. <source>Transcription</source>, <volume>8</volume>, <fpage>40</fpage>&#x02013;<lpage>47</lpage>.<pub-id pub-id-type="pmid">27792455</pub-id></mixed-citation></ref><ref id="btz064-B29"><mixed-citation publication-type="journal">Roadmap Epigenomics Consortium <etal>et al</etal> (<year>2015</year>) 
<article-title>Integrative analysis of 111 reference human epigenomes</article-title>. <source>Nature</source>, <volume>518</volume>, <fpage>317</fpage>&#x02013;<lpage>330</lpage>.<pub-id pub-id-type="pmid">25693563</pub-id></mixed-citation></ref><ref id="btz064-B30"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Rousseeuw</surname><given-names>P.J.</given-names></name></person-group> (<year>1987</year>) 
<article-title>Silhouettes: a graphical aid to the interpretation and validation of cluster analysis</article-title>. <source>J. Comput. Appl. Math</source>., <volume>20</volume>, <fpage>53</fpage>&#x02013;<lpage>65</lpage>.</mixed-citation></ref><ref id="btz064-B31"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Schott</surname><given-names>J.-J.</given-names></name></person-group>
<etal>et al</etal> (<year>1998</year>) 
<article-title>Congenital heart disease caused by mutations in the transcription factor NKX2-5</article-title>. <source>Science</source>, <volume>281</volume>, <fpage>108</fpage>&#x02013;<lpage>111</lpage>.<pub-id pub-id-type="pmid">9651244</pub-id></mixed-citation></ref><ref id="btz064-B32"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Spicuglia</surname><given-names>S.</given-names></name>, <name name-style="western"><surname>Vanhille</surname><given-names>L.</given-names></name></person-group> (<year>2012</year>) 
<article-title>Chromatin signatures of active enhancers</article-title>. <source>Nucleus</source>, <volume>3</volume>, <fpage>126</fpage>&#x02013;<lpage>131</lpage>.<pub-id pub-id-type="pmid">22555596</pub-id></mixed-citation></ref><ref id="btz064-B33"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Tanaka</surname><given-names>M.</given-names></name></person-group>
<etal>et al</etal> (<year>1999</year>) 
<article-title>The cardiac homeobox gene Csx/Nkx2.5 lies genetically upstream of multiple genes essential for heart development</article-title>. <source>Development</source>, <volume>126</volume>, <fpage>1269</fpage>&#x02013;<lpage>1280</lpage>.<pub-id pub-id-type="pmid">10021345</pub-id></mixed-citation></ref><ref id="btz064-B34"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Visel</surname><given-names>A.</given-names></name></person-group>
<etal>et al</etal> (<year>2007</year>) 
<article-title>Vista enhancer browser&#x02013;a database of tissue-specific human enhancers</article-title>. <source>Nucleic Acids Res</source>., <volume>35</volume>, <fpage>D88</fpage>&#x02013;<lpage>D92</lpage>.<pub-id pub-id-type="pmid">17130149</pub-id></mixed-citation></ref><ref id="btz064-B35"><mixed-citation publication-type="book">
<person-group person-group-type="author"><name name-style="western"><surname>Vlachos</surname><given-names>A.</given-names></name></person-group>
<etal>et al</etal> (<year>2009</year>) <chapter-title>Unsupervised and constrained dirichlet process mixture models for verb clustering</chapter-title> In: <source>Proceedings of the Workshop on Geometrical Models of Natural Language Semantics, GEMS &#x02019;09</source>. 
<publisher-name>Association for Computational Linguistics</publisher-name>, 
<publisher-loc>Stroudsburg, PA, USA</publisher-loc>, pp. <fpage>74</fpage>&#x02013;<lpage>82</lpage>.</mixed-citation></ref><ref id="btz064-B36"><mixed-citation publication-type="book">
<person-group person-group-type="author"><name name-style="western"><surname>Wagstaff</surname><given-names>K.</given-names></name></person-group>
<etal>et al</etal> (<year>2001</year>) <chapter-title>Constrained k-means clustering with background knowledge</chapter-title> In: <source>Proceedings of the Eighteenth International Conference on Machine Learning, ICML &#x02019;01</source>. 
<publisher-name>Morgan Kaufmann Publishers Inc</publisher-name>, 
<publisher-loc>San Francisco, CA, USA</publisher-loc>, pp. <fpage>577</fpage>&#x02013;<lpage>584</lpage>.</mixed-citation></ref><ref id="btz064-B37"><mixed-citation publication-type="journal">
<person-group person-group-type="author"><name name-style="western"><surname>Zentner</surname><given-names>G.E.</given-names></name></person-group>
<etal>et al</etal> (<year>2011</year>) 
<article-title>Epigenetic signatures distinguish multiple classes of enhancers with distinct cellular functions</article-title>. <source>Genome Res</source>., <volume>21</volume>, <fpage>1273</fpage>&#x02013;<lpage>1283</lpage>.<pub-id pub-id-type="pmid">21632746</pub-id></mixed-citation></ref></ref-list></back></article>